<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1.0"/>
<title>Aiaxcart Premium | Admin</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<style>
  :root {
    --primary: #FFB0B5;
    --secondary: #FFD3D6;
    --accent: #FF6B8B;
    --dark: #5a3e36;
    --light: #fefaf7;
    --success: #28a745;
    --warning: #ff9800;
    --danger: #e74c3c;
    --card-bg: #ffffff;
    --shadow: 0 4px 15px rgba(0,0,0,.08);
  }
  
  * {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
  }
  
  body {
    background: var(--light);
    color: var(--dark);
    font-family: 'Segoe UI', Tahoma, Verdana, sans-serif;
    line-height: 1.6;
  }
  
  /* Header Styles - Matching Original */
  header {
    background: var(--secondary);
    box-shadow: 0 4px 15px rgba(0,0,0,.08);
    position: sticky;
    top: 0;
    z-index: 100;
  }
  
  .container {
    max-width: 1400px;
    margin: 0 auto;
    padding: 0 20px;
  }
  
  .header-content {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 1rem 0;
  }
  
  .logo {
    font-size: 1.5rem;
    font-weight: 700;
    color: var(--dark);
  }
  
  nav ul {
    display: flex;
    gap: 1rem;
    margin: 0;
    padding: 0;
    list-style: none;
  }
  
  nav a {
    color: var(--dark);
    text-decoration: none;
    padding: .5rem 1rem;
    border-radius: 8px;
    transition: all 0.3s ease;
  }
  
  nav a.active, nav a:hover {
    background: var(--primary);
    color: white;
  }

  /* Admin Layout */
  .admin-layout {
    display: flex;
    min-height: calc(100vh - 80px);
  }
  
  .sidebar {
    width: 280px;
    background: var(--card-bg);
    box-shadow: 2px 0 10px rgba(0,0,0,.05);
    padding: 1.5rem 1rem;
    border-right: 1px solid #F9E6E4;
  }
  
  .main-content {
    flex: 1;
    padding: 1.5rem;
    background: #fefaf7;
  }
  
  /* Sidebar Styles */
  .admin-nav {
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
  }
  
  .nav-item {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    padding: 0.75rem 1rem;
    border-radius: 8px;
    cursor: pointer;
    transition: all 0.3s ease;
    text-decoration: none;
    color: var(--dark);
    border: none;
    background: none;
    width: 100%;
    text-align: left;
    font-size: 0.95rem;
  }
  
  .nav-item.active, .nav-item:hover {
    background: var(--primary);
    color: white;
  }
  
  .nav-item i {
    width: 20px;
    text-align: center;
    font-size: 1rem;
  }
  
  /* Dashboard Styles */
  .dashboard-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 2rem;
    padding-bottom: 1rem;
    border-bottom: 2px solid var(--secondary);
  }
  
  .stats-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
    gap: 1.5rem;
    margin-bottom: 2rem;
  }
  
  .stat-card {
    background: var(--card-bg);
    border-radius: 12px;
    padding: 1.5rem;
    box-shadow: var(--shadow);
    text-align: center;
    transition: transform 0.3s ease;
    border-top: 4px solid var(--primary);
  }
  
  .stat-card:hover {
    transform: translateY(-3px);
  }
  
  .stat-card h3 {
    margin-top: 0;
    font-size: 0.9rem;
    color: #777;
    text-transform: uppercase;
    letter-spacing: 1px;
  }
  
  .stat-value {
    font-size: 2rem;
    font-weight: 700;
    margin: 0.5rem 0;
    color: var(--dark);
  }
  
  .stat-change {
    font-size: 0.8rem;
    padding: 0.2rem 0.5rem;
    border-radius: 999px;
    display: inline-block;
  }
  
  .positive {
    background: rgba(40, 167, 69, 0.1);
    color: var(--success);
  }
  
  .negative {
    background: rgba(231, 76, 60, 0.1);
    color: var(--danger);
  }
  
  .dashboard-actions {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
    gap: 1rem;
    margin-bottom: 2rem;
  }
  
  .action-btn {
    background: var(--card-bg);
    border: none;
    border-radius: 12px;
    padding: 1.5rem;
    box-shadow: var(--shadow);
    cursor: pointer;
    transition: all 0.3s ease;
    text-align: center;
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 0.5rem;
    color: var(--dark);
    text-decoration: none;
  }
  
  .action-btn:hover {
    background: var(--primary);
    color: white;
    transform: translateY(-3px);
  }
  
  .action-btn i {
    font-size: 1.5rem;
  }
  
  /* Panel Styles */
  .panel {
    display: none;
  }
  
  .panel.active {
    display: block;
    animation: fadeIn 0.3s ease;
  }

  @keyframes fadeIn {
    from { opacity: 0; transform: translateY(10px); }
    to { opacity: 1; transform: translateY(0); }
  }
  
  .card {
    background: var(--card-bg);
    border-radius: 12px;
    padding: 1.5rem;
    box-shadow: var(--shadow);
    margin-bottom: 1.5rem;
    border: 1px solid #F9E6E4;
  }
  
  .card h3 {
    margin-bottom: 1rem;
    color: var(--dark);
    border-bottom: 2px solid var(--secondary);
    padding-bottom: 0.5rem;
    display: flex;
    align-items: center;
    gap: 0.5rem;
  }
  
  /* Form Styles */
  .form-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 1rem;
  }
  
  .form-group {
    margin-bottom: 1rem;
  }
  
  .form-group label {
    display: block;
    margin-bottom: 0.5rem;
    font-weight: 600;
    color: var(--dark);
    font-size: 0.9rem;
  }
  
  .form-control {
    width: 100%;
    padding: 0.75rem;
    border: 1px solid #E8E8E8;
    border-radius: 8px;
    font-size: 1rem;
    transition: border 0.3s ease;
    background: #fff;
  }
  
  .form-control:focus {
    outline: none;
    border-color: var(--primary);
    box-shadow: 0 0 0 3px rgba(255, 176, 181, 0.1);
  }
  
  .btn {
    padding: .75rem 1.5rem;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    font-weight: 600;
    transition: all 0.3s ease;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    gap: 0.5rem;
    font-size: 0.9rem;
  }
  
  .btn-primary {
    background: var(--primary);
    color: white;
  }
  
  .btn-primary:hover {
    background: #ff9aa1;
    transform: translateY(-2px);
  }
  
  .btn-success {
    background: var(--success);
    color: white;
  }
  
  .btn-warning {
    background: var(--warning);
    color: white;
  }
  
  .btn-danger {
    background: var(--danger);
    color: white;
  }
  
  .btn-outline {
    background: transparent;
    border: 1px solid var(--primary);
    color: var(--primary);
  }
  
  .btn-outline:hover {
    background: var(--primary);
    color: white;
  }

  .btn-sm {
    padding: 0.5rem 1rem;
    font-size: 0.8rem;
  }
  
  /* Table Styles */
  .table-responsive {
    overflow-x: auto;
    border-radius: 8px;
    border: 1px solid #F9E6E4;
  }
  
  .data-table {
    width: 100%;
    border-collapse: collapse;
    background: white;
  }
  
  .data-table th,
  .data-table td {
    padding: 0.75rem;
    text-align: left;
    border-bottom: 1px solid #F9E6E4;
  }
  
  .data-table th {
    background: var(--secondary);
    font-weight: 600;
    color: var(--dark);
    font-size: 0.9rem;
  }
  
  .data-table tr:hover {
    background: rgba(255, 211, 214, 0.1);
  }
  
  .status-badge {
    display: inline-block;
    padding: 0.3rem 0.7rem;
    border-radius: 999px;
    font-size: 0.8rem;
    font-weight: 600;
  }
  
  .status-pending {
    background: #fff3cd;
    color: #856404;
  }
  
  .status-confirmed {
    background: #d4edda;
    color: #155724;
  }
  
  .status-completed {
    background: #d1ecf1;
    color: #0c5460;
  }
  
  /* Toast */
  #toast {
    position: fixed;
    right: 16px;
    bottom: 16px;
    display: grid;
    gap: 8px;
    z-index: 99999;
  }
  
  .toast {
    background: #333;
    color: #fff;
    padding: .7rem 1rem;
    border-radius: 10px;
    box-shadow: 0 6px 20px rgba(0,0,0,.15);
    opacity: .98;
    max-width: 300px;
  }
  
  .toast.ok {
    background: var(--success);
  }
  
  .toast.warn {
    background: var(--warning);
  }
  
  .toast.err {
    background: var(--danger);
  }

  /* Search and Filter */
  .search-wrap {
    margin: 1rem 0;
    position: relative;
  }
  
  .search-wrap input {
    width: 100%;
    padding: .8rem 1rem .8rem 2.4rem;
    border: 1px solid #F9E6E4;
    border-radius: 10px;
    font-size: 1rem;
    background: white;
  }
  
  .search-wrap span {
    position: absolute;
    left: .8rem;
    top: 50%;
    transform: translateY(-50%);
    color: #777;
  }

  /* Records Table */
  .records-table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 1rem;
    background: white;
    border-radius: 8px;
    overflow: hidden;
    box-shadow: 0 2px 8px rgba(0,0,0,.06);
  }
  
  .records-table th,
  .records-table td {
    padding: 0.75rem;
    text-align: left;
    border-bottom: 1px solid #F9E6E4;
    font-size: 0.9rem;
  }
  
  .records-table th {
    background: var(--secondary);
    font-weight: 600;
  }
  
  .records-table tr:hover {
    background: rgba(255, 211, 214, 0.1);
  }

  /* Grid for lists */
  .grid {
    display: flex;
    flex-direction: column;
    gap: 1rem;
  }

  .row {
    margin-bottom: 1rem;
  }

  .row label {
    display: block;
    margin-bottom: 0.5rem;
    font-weight: 600;
  }

  .note {
    font-size: .85rem;
    opacity: .8;
    color: #666;
  }

  /* Responsive */
  @media (max-width: 768px) {
    .admin-layout {
      flex-direction: column;
    }
    
    .sidebar {
      width: 100%;
      border-right: none;
      border-bottom: 1px solid #F9E6E4;
    }
    
    .stats-grid {
      grid-template-columns: 1fr;
    }
    
    .dashboard-actions {
      grid-template-columns: 1fr;
    }
    
    .header-content {
      flex-direction: column;
      gap: 1rem;
    }

    .form-grid {
      grid-template-columns: 1fr;
    }
  }
</style>
</head>
<body>
<div id="toast"></div>

<!-- SESSION GUARD -->
<script>
const OWNER_UID="2ece6eb8-ed7d-4e52-b1b8-f9220fb87e36",SESSION_MIN=60,SESSION_VER="2025-11-12";
function clearSession(){['ad-ok','ad-ok-ts','ad-owner-uid','ad-session-ver'].forEach(k=>localStorage.removeItem(k));}
function setSession(uid){
  localStorage.setItem('ad-ok','1');
  localStorage.setItem('ad-ok-ts',Date.now());
  localStorage.setItem('ad-owner-uid',uid);
  localStorage.setItem('ad-session-ver',SESSION_VER);
}
function isVerified(){
  const ok=localStorage.getItem('ad-ok')==='1';
  const ts=parseInt(localStorage.getItem('ad-ok-ts')||'0',10);
  const fresh=(Date.now()-ts)<(SESSION_MIN*60*1000);
  const uidOk=localStorage.getItem('ad-owner-uid')===OWNER_UID;
  const verOk=localStorage.getItem('ad-session-ver')===SESSION_VER;
  return ok&&fresh&&uidOk&&verOk;
}
(function(){try{ if(!isVerified()) clearSession(); else localStorage.setItem('ad-ok-ts',Date.now()); }catch(e){clearSession();}})();
function toast(msg,type='ok'){
  const box=document.getElementById('toast');
  const el=document.createElement('div');
  el.className=`toast ${type}`;
  el.textContent=msg;
  box.appendChild(el);
  setTimeout(()=>{ el.style.opacity='0'; setTimeout(()=>el.remove(),300); },3000);
}
</script>

<header>
  <div class="container header-content">
    <div class="logo">ðŸ›’ Aiaxcart Premium Admin</div>
    <nav>
      <ul>
        <li><a href="index.html">Home</a></li>
        <li><a class="active" href="admin.html">Admin</a></li>
      </ul>
    </nav>
  </div>
</header>

<!-- Verify Modal -->
<div id="ownerVeriOverlay" style="position:fixed;inset:0;background:rgba(0,0,0,.8);display:none;align-items:center;justify-content:center;z-index:9999;">
  <div class="card" style="min-width:320px">
    <h3><i class="fas fa-shield-alt"></i> Owner Verification</h3>
    <div class="form-group">
      <input id="ownerUidInput" class="form-control" placeholder="Enter Owner UID">
    </div>
    <button class="btn btn-primary" onclick="verifyOwnerUID()">Verify</button>
    <div id="ownerVeriMsg" style="color:#c33;margin-top:.6rem"></div>
  </div>
</div>

<div class="admin-layout" id="admin-dashboard" style="display:none">
  <!-- Sidebar -->
  <div class="sidebar">
    <div class="admin-nav">
      <button class="nav-item active" data-panel="dashboard">
        <i class="fas fa-tachometer-alt"></i>
        <span>Dashboard</span>
      </button>
      <button class="nav-item" data-panel="add-stock">
        <i class="fas fa-plus-circle"></i>
        <span>Add Stock</span>
      </button>
      <button class="nav-item" data-panel="manage-stocks">
        <i class="fas fa-boxes"></i>
        <span>Manage Stocks</span>
      </button>
      <button class="nav-item" data-panel="pending-orders">
        <i class="fas fa-clipboard-list"></i>
        <span>Pending Orders</span>
      </button>
      <button class="nav-item" data-panel="sold-accounts">
        <i class="fas fa-chart-line"></i>
        <span>Sold Accounts</span>
      </button>
      <button class="nav-item" data-panel="archived-stocks">
        <i class="fas fa-archive"></i>
        <span>Archived Stocks</span>
      </button>
      <button class="nav-item" data-panel="products">
        <i class="fas fa-shopping-bag"></i>
        <span>Products</span>
      </button>
      <button class="nav-item" data-panel="rules">
        <i class="fas fa-gavel"></i>
        <span>Store Rules</span>
      </button>
      <button class="nav-item" data-panel="records">
        <i class="fas fa-file-alt"></i>
        <span>Records</span>
      </button>
      <button class="nav-item" data-panel="reports">
        <i class="fas fa-flag"></i>
        <span>Reports</span>
      </button>
    </div>
  </div>

  <!-- Main Content -->
  <div class="main-content">
    <!-- Dashboard Panel -->
    <div id="dashboard" class="panel active">
      <div class="dashboard-header">
        <h1>Admin Dashboard</h1>
        <button class="btn btn-primary" onclick="showPanel('add-stock')">
          <i class="fas fa-plus"></i> Add Stock
        </button>
      </div>
      
      <div class="stats-grid">
        <div class="stat-card">
          <h3>Total Products</h3>
          <div class="stat-value" id="stat-products">0</div>
          <div class="stat-change positive">+2 this week</div>
        </div>
        <div class="stat-card">
          <h3>Available Stock</h3>
          <div class="stat-value" id="stat-stock">0</div>
          <div class="stat-change negative">-5 today</div>
        </div>
        <div class="stat-card">
          <h3>Pending Orders</h3>
          <div class="stat-value" id="stat-pending">0</div>
          <div class="stat-change positive">-3 today</div>
        </div>
        <div class="stat-card">
          <h3>Total Revenue</h3>
          <div class="stat-value" id="stat-revenue">â‚±0</div>
          <div class="stat-change positive">+â‚±1,240 today</div>
        </div>
      </div>
      
      <div class="dashboard-actions">
        <button class="action-btn" onclick="showPanel('manage-stocks')">
          <i class="fas fa-boxes"></i>
          <span>Manage Stocks</span>
        </button>
        <button class="action-btn" onclick="showPanel('pending-orders')">
          <i class="fas fa-clipboard-list"></i>
          <span>Pending Orders</span>
        </button>
        <button class="action-btn" onclick="showPanel('sold-accounts')">
          <i class="fas fa-chart-bar"></i>
          <span>Sales Reports</span>
        </button>
        <button class="action-btn" onclick="showPanel('archived-stocks')">
          <i class="fas fa-archive"></i>
          <span>Archived Stocks</span>
        </button>
        <button class="action-btn" onclick="showPanel('products')">
          <i class="fas fa-cog"></i>
          <span>Store Settings</span>
        </button>
        <button class="action-btn" onclick="showPanel('rules')">
          <i class="fas fa-file-alt"></i>
          <span>Store Rules</span>
        </button>
      </div>
      
      <div class="card">
        <h3><i class="fas fa-clock"></i> Recent Orders</h3>
        <div class="search-wrap">
          <span><i class="fas fa-search"></i></span>
          <input type="text" placeholder="Search orders...">
        </div>
        <div class="table-responsive">
          <table class="data-table">
            <thead>
              <tr>
                <th>Order ID</th>
                <th>Buyer/Email</th>
                <th>Product</th>
                <th>Purchase Date</th>
                <th>Status</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody id="recent-orders">
              <tr><td colspan="6" style="text-align:center">Loading...</td></tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>

    <!-- Add Stock Panel -->
    <div id="add-stock" class="panel">
      <div class="card">
        <h3><i class="fas fa-plus-circle"></i> Add Stock</h3>
        <form id="fAdd" class="form-grid">
          <div class="form-group">
            <label>Product</label>
            <select id="as-product" class="form-control"></select>
          </div>
          <div class="form-group">
            <label>Account Type</label>
            <select id="as-type" class="form-control"></select>
          </div>
          <div class="form-group">
            <label>Duration</label>
            <select id="as-dur" class="form-control"></select>
          </div>
          <div class="form-group">
            <label>Quantity</label>
            <input id="as-qty" type="number" min="1" value="1" class="form-control">
          </div>
          <div class="form-group">
            <label>Email</label>
            <input id="as-email" class="form-control" placeholder="Account email">
          </div>
          <div class="form-group">
            <label>Password</label>
            <input id="as-pass" class="form-control" placeholder="Account password">
          </div>
          <div class="form-group">
            <label>Profile</label>
            <input id="as-prof" class="form-control" placeholder="Profile name">
          </div>
          <div class="form-group">
            <label>PIN</label>
            <input id="as-pin" class="form-control" placeholder="PIN code">
          </div>
          <div class="form-group">
            <label>Auto-Archive (Days)</label>
            <input id="as-drop" type="number" min="0" value="0" class="form-control">
          </div>
          <div class="form-group">
            <label>Premium Until</label>
            <input id="as-premAt" type="date" class="form-control">
          </div>
          <div class="form-group">
            <button class="btn btn-primary" type="submit">
              <i class="fas fa-save"></i> Add Stock
            </button>
          </div>
        </form>
        <div id="msgAdd" style="color:#0a0;margin-top:.6rem"></div>
      </div>
    </div>

    <!-- Manage Stocks Panel -->
    <div id="manage-stocks" class="panel">
      <div class="card">
        <h3><i class="fas fa-boxes"></i> Manage Stocks</h3>
        <div class="search-wrap">
          <span><i class="fas fa-search"></i></span>
          <input type="text" placeholder="Search stocks...">
        </div>
        <div id="manageList" class="grid">
          <div class="note">Loading available stocks...</div>
        </div>
      </div>
    </div>

    <!-- Pending Orders Panel -->
    <div id="pending-orders" class="panel">
      <div class="card">
        <h3><i class="fas fa-clipboard-list"></i> Pending Orders</h3>
        <div id="pendingList" class="grid">
          <div class="note">Loading pending orders...</div>
        </div>
      </div>
    </div>

    <!-- Sold Accounts Panel -->
    <div id="sold-accounts" class="panel">
      <div class="card">
        <h3><i class="fas fa-chart-line"></i> Sold Accounts</h3>
        <div id="soldList" class="grid">
          <div class="note">Loading sold accounts...</div>
        </div>
      </div>
    </div>

    <!-- Archived Stocks Panel -->
    <div id="archived-stocks" class="panel">
      <div class="card">
        <h3><i class="fas fa-archive"></i> Archived Stocks</h3>
        <div id="archList" class="grid">
          <div class="note">Loading archived stocks...</div>
        </div>
      </div>
    </div>

    <!-- Products Panel -->
    <div id="products" class="panel">
      <div class="card">
        <h3><i class="fas fa-plus"></i> Add Product</h3>
        <form id="fProd">
          <div class="form-grid">
            <div class="form-group">
              <label>Product Name</label>
              <input id="pr-name" class="form-control" placeholder="Enter product name">
            </div>
            <div class="form-group">
              <label>Category</label>
              <select id="pr-cat" class="form-control">
                <option value="entertainment">Entertainment</option>
                <option value="streaming">Streaming</option>
                <option value="educational">Educational</option>
                <option value="editing">Editing</option>
                <option value="ai">AI</option>
              </select>
            </div>
            <div class="form-group">
              <label>Icon</label>
              <input id="pr-icon" class="form-control" placeholder="e.g. ðŸ“º">
            </div>
          </div>
          <button class="btn btn-primary" type="submit">
            <i class="fas fa-plus"></i> Add Product
          </button>
        </form>
      </div>
      
      <div class="card">
        <h3><i class="fas fa-shopping-bag"></i> Products List</h3>
        <div class="form-group">
          <label>Filter by Category</label>
          <select id="prodFilter" class="form-control">
            <option value="">All Categories</option>
            <option value="entertainment">Entertainment</option>
            <option value="streaming">Streaming</option>
            <option value="educational">Educational</option>
            <option value="editing">Editing</option>
            <option value="ai">AI</option>
          </select>
        </div>
        <div id="prodList" class="grid">
          <div class="note">Loading products...</div>
        </div>
      </div>
    </div>

    <!-- Records Panel -->
    <div id="records" class="panel">
      <div class="card">
        <h3><i class="fas fa-file-alt"></i> Records Summary</h3>
        <div id="recInfo" class="grid">
          <div class="note">Loading records...</div>
        </div>
      </div>
      
      <div class="card">
        <h3><i class="fas fa-table"></i> Detailed Records</h3>
        <div class="table-responsive">
          <table class="records-table">
            <thead>
              <tr>
                <th>Order ID</th>
                <th>Buyer/Email</th>
                <th>Product</th>
                <th>Account Type</th>
                <th>Duration</th>
                <th>Purchase Date</th>
                <th>Price</th>
                <th>Status</th>
              </tr>
            </thead>
            <tbody id="detailedRecords">
              <tr><td colspan="8" style="text-align:center">Loading detailed records...</td></tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>

    <!-- Add other panels (Rules, Reports) following the same structure -->
    <div id="rules" class="panel">
      <div class="card">
        <h3><i class="fas fa-gavel"></i> Store Rules</h3>
        <div class="note">Rules management panel - to be implemented</div>
      </div>
    </div>

    <div id="reports" class="panel">
      <div class="card">
        <h3><i class="fas fa-flag"></i> Buyer Reports</h3>
        <div class="note">Reports management panel - to be implemented</div>
      </div>
    </div>
  </div>
</div>

<!-- CONFIG -->
<script>
window.CONFIG_PUBLIC = {
  DATABASE: {
    SUPABASE_URL: "https://oujvsjnbxmgpdoftzpxl.supabase.co",
    SUPABASE_ANON_KEY: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im91anZzam5ieG1ncGRvZnR6cHhsIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjI4NzE1NTYsImV4cCI6MjA3ODQ0NzU1Nn0.vs06C-2kx4H2whyTReUPsVgLYhWotfkzetxdKD5LVQo"
  },
  ADMIN: { OWNER_UID: "2ece6eb8-ed7d-4e52-b1b8-f9220fb87e36" }
};
window.CONFIG = window.CONFIG_PUBLIC;
</script>
<script src="https://unpkg.com/@supabase/supabase-js@2"></script>
<script src="assets/js/aiaxcart/supabase.js?v=6"></script>

<script>
// Use your existing Supabase client
const SB = createDbClient();
const $ = (id) => document.getElementById(id);

/* Navigation */
function showPanel(panelId) {
  // Hide all panels
  document.querySelectorAll('.panel').forEach(panel => {
    panel.classList.remove('active');
  });
  
  // Show selected panel
  $(panelId).classList.add('active');
  
  // Update active nav item
  document.querySelectorAll('.nav-item').forEach(item => {
    item.classList.remove('active');
  });
  
  document.querySelector(`[data-panel="${panelId}"]`).classList.add('active');
  
  // Refresh data for the panel
  if (panelId === 'dashboard') refreshDashboard();
  else if (panelId === 'manage-stocks') refreshManageStocks();
  else if (panelId === 'pending-orders') refreshPendingOrders();
  else if (panelId === 'sold-accounts') refreshSoldAccounts();
  else if (panelId === 'archived-stocks') refreshArchivedStocks();
  else if (panelId === 'products') refreshProducts();
  else if (panelId === 'records') refreshRecords();
}

// Add event listeners to nav items
document.querySelectorAll('.nav-item').forEach(item => {
  item.addEventListener('click', function(e) {
    e.preventDefault();
    const panelId = this.getAttribute('data-panel');
    showPanel(panelId);
  });
});

/* Verify */
async function verifyOwnerUID() {
  const uid = ($('#ownerUidInput').value || '').trim();
  const msg = $('#ownerVeriMsg');
  if (!uid) { msg.textContent = 'Enter UID.'; return; }
  
  function ok() {
    setSession(uid);
    msg.style.color = '#2a7';
    msg.textContent = 'Verified. Loading admin panel...';
    setTimeout(() => {
      $('#ownerVeriOverlay').style.display = 'none';
      showAdmin();
    }, 1000);
  }
  
  try {
    const yes = await db_isUidAdmin(uid);
    if (yes || uid === window.CONFIG.ADMIN.OWNER_UID) { 
      ok(); 
    } else { 
      msg.textContent = 'Invalid UID.'; 
      clearSession(); 
    }
  } catch(e) {
    if (uid === window.CONFIG.ADMIN.OWNER_UID) { 
      ok(); 
    } else { 
      msg.textContent = 'Verification failed.'; 
    }
  }
}

// Check verification on load
(function() {
  if (!isVerified()) {
    $('#ownerVeriOverlay').style.display = 'flex';
  } else {
    showAdmin();
  }
})();

/* Admin boot */
function showAdmin() {
  $('#admin-dashboard').style.display = 'flex';
  bootAdmin();
}

async function bootAdmin() {
  try { 
    await db_autodropStale(); 
  } catch(e) { 
    console.log('Auto-drop stale completed or failed:', e);
  }
  
  // Initialize form options
  const accTypes = ["Solo Account", "Shared Account", "Solo Profile", "Shared Profile", "Fam Head", "Invite", "Solo FW", "Solo NW", "Teamhead Account", "Edu Lifetime", "Teamhead"];
  const durs = ["7d", "14d", "1m", "2m", "3m", "4m", "5m", "6m", "8m", "10m", "12m", "24m", "NW", "3m W", "6m W", "12m W"];
  
  fillSelect('as-type', accTypes);
  fillSelect('as-dur', durs);

  // Form handlers
  $('#fAdd').onsubmit = async (e) => {
    e.preventDefault();
    const btn = $('#fAdd').querySelector('button[type="submit"]');
    btn.disabled = true;
    btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Adding...';
    
    try {
      const payload = {
        product_id: $('#as-product').value,
        account_type: $('#as-type').value,
        duration_key: $('#as-dur').value,
        email: $('#as-email').value || null,
        password: $('#as-pass').value || null,
        profile: $('#as-prof').value || null,
        pin: $('#as-pin').value || null,
        quantity: Number($('#as-qty').value || 1),
        auto_drop_days: Number($('#as-drop').value || 0),
        premium_until: $('#as-premAt').value ? new Date($('#as-premAt').value).toISOString() : null
      };
      
      await db_addStock(payload);
      toast('Stock added successfully!', 'ok');
      
      // Reset form
      $('#as-email').value = '';
      $('#as-pass').value = '';
      $('#as-prof').value = '';
      $('#as-pin').value = '';
      $('#as-qty').value = 1;
      $('#as-drop').value = 0;
      $('#as-premAt').value = '';
      
      await refreshAll();
    } catch(error) {
      toast('Error adding stock: ' + error.message, 'err');
    } finally {
      btn.disabled = false;
      btn.innerHTML = '<i class="fas fa-save"></i> Add Stock';
    }
  };

  $('#fProd').onsubmit = async (e) => {
    e.preventDefault();
    try {
      await db_addProduct({
        name: $('#pr-name').value.trim(),
        category: $('#pr-cat').value,
        icon: $('#pr-icon').value || 'ðŸ›’',
        is_active: true
      });
      $('#pr-name').value = '';
      $('#pr-icon').value = '';
      toast('Product added successfully!', 'ok');
      await refreshAll();
    } catch(error) {
      toast('Error adding product: ' + error.message, 'err');
    }
  };

  // Set up real-time subscriptions
  db_subscribeStockAndOrders(() => {
    refreshAll();
    toast('Data updated in real-time', 'ok');
  });
  
  // Initial data load
  await refreshAll();
}

function fillSelect(id, arr) {
  const el = $(id);
  if (!el) return;
  el.innerHTML = arr.map(x => `<option value="${x}">${x}</option>`).join('');
}

/* Refresh Functions */
async function refreshAll() {
  await refreshDashboard();
  await refreshManageStocks();
  await refreshPendingOrders();
  await refreshSoldAccounts();
  await refreshArchivedStocks();
  await refreshProducts();
  await refreshRecords();
}

async function refreshDashboard() {
  try {
    const stats = await db_adminStats();
    $('#stat-products').innerText = stats.products || 0;
    $('#stat-stock').innerText = stats.available || 0;
    $('#stat-pending').innerText = stats.pending || 0;
    $('#stat-revenue').innerText = 'â‚±' + (stats.revenue || 0);

    const products = await db_listProducts();
    $('#as-product').innerHTML = products.map(p => 
      `<option value="${p.id}">${p.name}</option>`
    ).join('');

    const pend = await db_listPendingOrders();
    $('#recent-orders').innerHTML = pend.slice(0, 5).map(o => `
      <tr>
        <td><strong>${o.id}</strong></td>
        <td>${o.buyer_name}<br><small>${o.buyer_email}</small></td>
        <td>${o.product_name}</td>
        <td>${new Date(o.created_at).toLocaleDateString()}</td>
        <td><span class="status-badge status-pending">Pending</span></td>
        <td>
          <button class="btn btn-success btn-sm" onclick="db_confirmOrder('${o.id}').then(()=>{toast('Order confirmed','ok');refreshAll();})">
            <i class="fas fa-check"></i>
          </button>
          <button class="btn btn-danger btn-sm" onclick="db_cancelOrder('${o.id}').then(()=>{toast('Order canceled','warn');refreshAll();})">
            <i class="fas fa-times"></i>
          </button>
        </td>
      </tr>
    `).join('') || '<tr><td colspan="6" style="text-align:center">No pending orders</td></tr>';
  } catch(error) {
    console.error('Error refreshing dashboard:', error);
    toast('Error loading dashboard data', 'err');
  }
}

async function refreshManageStocks() {
  try {
    const stocks = await db_listAvailableStocks();
    $('#manageList').innerHTML = stocks.length ? stocks.map(s => `
      <div class="card">
        <div><strong>${s.product_name}</strong> â€¢ ${s.account_type} â€¢ ${s.duration_key}</div>
        <div class="note">Email: ${s.email || 'N/A'} | Profile: ${s.profile || 'N/A'}</div>
        <div class="note">Added: ${new Date(s.created_at).toLocaleDateString()}</div>
        <div style="margin-top:.8rem; display: flex; gap: 0.5rem; flex-wrap: wrap;">
          <button class="btn btn-success btn-sm" onclick="db_markSold('${s.id}',0).then(()=>{toast('Marked sold','ok');refreshAll();})">
            <i class="fas fa-check"></i> Sold
          </button>
          <button class="btn btn-warning btn-sm" onclick="db_archiveStock('${s.id}',new Date().toISOString()).then(()=>{toast('Archived','warn');refreshAll();})">
            <i class="fas fa-archive"></i> Archive
          </button>
          <button class="btn btn-danger btn-sm" onclick="if(confirm('Delete this stock?')) db_deleteStock('${s.id}').then(()=>{toast('Deleted','err');refreshAll();})">
            <i class="fas fa-trash"></i> Delete
          </button>
        </div>
      </div>
    `).join('') : '<div class="note">No available stocks.</div>';
  } catch(error) {
    $('#manageList').innerHTML = '<div class="note">Error loading stocks</div>';
  }
}

async function refreshPendingOrders() {
  try {
    const pend = await db_listPendingOrders();
    $('#pendingList').innerHTML = pend.length ? pend.map(o => `
      <div class="card">
        <div><strong>${o.product_name}</strong> â€¢ ${o.account_type} â€¢ ${o.duration_key}</div>
        <div class="note">Buyer: ${o.buyer_name} (${o.buyer_email})</div>
        <div class="note">Order ID: ${o.id} | Price: â‚±${o.price_php || 0}</div>
        <div style="margin-top:.8rem; display: flex; gap: 0.5rem;">
          <button class="btn btn-success" onclick="db_confirmOrder('${o.id}').then(()=>{toast('Order confirmed','ok');refreshAll();})">
            <i class="fas fa-check"></i> Confirm
          </button>
          <button class="btn btn-danger" onclick="db_cancelOrder('${o.id}').then(()=>{toast('Order canceled','err');refreshAll();})">
            <i class="fas fa-times"></i> Cancel
          </button>
        </div>
      </div>
    `).join('') : '<div class="note">No pending orders.</div>';
  } catch(error) {
    $('#pendingList').innerHTML = '<div class="note">Error loading orders</div>';
  }
}

async function refreshSoldAccounts() {
  try {
    const sold = await db_listSold();
    $('#soldList').innerHTML = sold.length ? sold.map(s => `
      <div class="card">
        <div><strong>${s.product_name}</strong> â€¢ ${s.account_type} â€¢ ${s.duration_key}</div>
        <div class="note">Price: â‚±${s.price_php || 0} | Sold: ${new Date(s.sold_at).toLocaleString()}</div>
      </div>
    `).join('') : '<div class="note">No sold records.</div>';
  } catch(error) {
    $('#soldList').innerHTML = '<div class="note">Error loading sold accounts</div>';
  }
}

async function refreshArchivedStocks() {
  try {
    const arch = await db_listArchived();
    $('#archList').innerHTML = arch.length ? arch.map(a => `
      <div class="card">
        <div><strong>${a.product_name}</strong> â€¢ ${a.account_type} â€¢ ${a.duration_key}</div>
        <div class="note">Archived: ${new Date(a.archived_at).toLocaleString()}</div>
        <div class="note">Email: ${a.email || 'N/A'} | Profile: ${a.profile || 'N/A'}</div>
      </div>
    `).join('') : '<div class="note">No archived stocks.</div>';
  } catch(error) {
    $('#archList').innerHTML = '<div class="note">Error loading archived stocks</div>';
  }
}

async function refreshProducts() {
  try {
    const products = await db_listProducts();
    const filter = $('#prodFilter').value || '';
    const filteredProducts = filter ? products.filter(p => p.category === filter) : products;
    
    $('#prodList').innerHTML = filteredProducts.length ? filteredProducts.map(p => `
      <div class="card">
        <div><strong>${p.icon || 'ðŸ›’'} ${p.name}</strong></div>
        <div class="note">Category: ${p.category || 'â€”'} | Active: ${p.is_active ? 'Yes' : 'No'}</div>
        <div style="margin-top:.8rem; display: flex; gap: 0.5rem;">
          <button class="btn btn-warning btn-sm" onclick="promptEditProduct('${p.id}')">
            <i class="fas fa-edit"></i> Edit
          </button>
          <button class="btn btn-danger btn-sm" onclick="if(confirm('Delete product ${p.name}?')) db_deleteProduct('${p.id}').then(()=>{toast('Deleted','warn');refreshAll();})">
            <i class="fas fa-trash"></i> Delete
          </button>
        </div>
      </div>
    `).join('') : '<div class="note">No products found.</div>';
  } catch(error) {
    $('#prodList').innerHTML = '<div class="note">Error loading products</div>';
  }
}

async function refreshRecords() {
  try {
    const rec = await db_listRecordsSummary();
    $('#recInfo').innerHTML = `
      <div class="stat-card">
        <h3>Total Records</h3>
        <div class="stat-value">${rec.total || 0}</div>
      </div>
      <div class="stat-card">
        <h3>Total Revenue</h3>
        <div class="stat-value">â‚±${rec.revenue || 0}</div>
      </div>
      <div class="stat-card">
        <h3>Website Orders</h3>
        <div class="stat-value">${rec.web || 0}</div>
      </div>
      <div class="stat-card">
        <h3>Social Orders</h3>
        <div class="stat-value">${rec.social || 0}</div>
      </div>
    `;
  } catch(error) {
    $('#recInfo').innerHTML = '<div class="note">Error loading records summary</div>';
  }
}

// Product edit function
async function promptEditProduct(id) {
  const products = await db_listProducts();
  const product = products.find(p => p.id === id);
  if (!product) return;

  const name = prompt('New product name:', product.name);
  const category = prompt('New category (entertainment/streaming/educational/editing/ai):', product.category);
  const icon = prompt('New icon:', product.icon || 'ðŸ›’');
  
  if (name !== null) {
    await db_updateProduct({ 
      id, 
      name: name || product.name, 
      category: category || product.category, 
      icon: icon || product.icon 
    });
    toast('Product updated successfully!', 'ok');
    refreshAll();
  }
}

// Auto-refresh every 30 seconds
setInterval(refreshAll, 30000);

// Category filter
$('#prodFilter').onchange = refreshProducts;

// Session management
document.addEventListener('visibilitychange', () => {
  if (document.visibilityState === 'visible') {
    if (!isVerified()) { 
      clearSession(); 
      location.reload(); 
    } else { 
      localStorage.setItem('ad-ok-ts', Date.now()); 
    }
  }
});
</script>
</body>
</html>