<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <title>Aiaxcart Premium | Admin</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <style>
    body { background: #fefaf7; color: #382f2c; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
    .container { max-width: 1100px; margin: 0 auto; padding: 0 20px; }
    .logo { font-size: 2rem; font-weight: 700; display: flex; align-items: center;}
    header { background: #FFD3D6; padding: 1.3rem 0 1.1rem 0; box-shadow: 0 6px 22px rgba(0,0,0,0.08);}
    .header-content { display: flex; justify-content: space-between; align-items: center;}
    nav ul { display: flex; list-style: none;}
    nav ul li {margin-left: 2.2rem;}
    nav ul li a { color: #382f2c; text-decoration: none; font-weight: 500; padding: 0.6rem 1.4rem; border-radius: 10px;}
    nav ul li a.active, nav ul li a:hover {background: #FFC6CA;}
    .tabs { display: flex; gap: 0.95rem; margin: 2rem 0 1.5rem 0; flex-wrap: wrap;}
    .tab { padding: 0.85rem 1.55rem; border: none; background: #fff; border-radius: 14px; font-size: 1rem; font-weight: 500; box-shadow: 0 1px 4px rgba(0,0,0,0.03); cursor: pointer; transition: background 0.2s; }
    .tab.active { background: #FFD3D6;}
    .panel { display: none; }
    .panel.active { display: block; }
    .stats-grid { display: grid; grid-template-columns: repeat(4,1fr); gap: 1.3rem; margin-bottom:2rem;}
    .stat-card { background: #fff; padding: 2rem 0 1.25rem 0; border-radius: 13px; text-align:center; box-shadow: 0 2px 8px rgba(0,0,0,0.07);}
    .stat-card h3 { font-size: 2.1rem; margin-bottom: 0.55rem; color:#FFB0B5;}
    .card { background: #fff; border-radius: 13px; box-shadow: 0 2px 8px rgba(0,0,0,0.07); padding: 2.2rem 1.5rem; margin-bottom: 2rem;}
    label { margin:1rem 0 0.45rem 0; display: block; }
    select,input[type="text"],input[type="number"],input[type="email"],input[type="date"],textarea { padding:0.65rem 0.9rem;border-radius:8px;border:1px solid #E8E8E8;font-size:1rem;width:100%;font-family:inherit; }
    .btn {padding: 0.65rem 1.55rem; border:none; border-radius:9px; font-weight:500; font-size: 1rem; cursor:pointer; transition: all 0.3s ease;}
    .btn-primary {background: #FFB0B5; color:white;} .btn-primary:hover {background: #FF8A90;}
    .btn-danger {background: #FF6B6B; color:white;} .btn-danger:hover {background: #FF5252;}
    .btn-warning {background: #FFA726; color:white;} .btn-warning:hover {background: #FF9800;}
    .btn-success {background: #66BB6A; color:white;} .btn-success:hover {background: #4CAF50;}
    .btn-info {background: #42A5F5; color:white;} .btn-info:hover {background: #2196F3;}
    .btn-small {padding:0.3rem 0.8rem;font-size:0.95rem;margin-top:0.25rem;}
    .stock-list {display:flex;flex-direction:column;gap:1.2rem;}
    .stock-card {background:#fff5; border-radius:8px; padding:1rem 1.2rem; box-shadow:0 1px 7px rgba(0,0,0,0.04);}
    .stock-actions {margin-top:0.5rem; display: flex; gap: 0.5rem; flex-wrap: wrap;}
    .badge {display:inline-block;padding:0.18rem 0.9rem;border-radius:12px;font-size:0.90rem; font-weight:500;}
    .badge-pending {background: #fff3cd; color: #856404;} .badge-resolved {background: #d1ecf1; color: #0c5460;}
    .owner-veri-overlay{position:fixed;top:0;left:0;width:100vw;height:100vh;background:rgba(0,0,0,0.37);display:none;align-items:center;justify-content:center;z-index:9999;}
    .modal-card{position:relative;background:white;padding:2.7rem 2.5rem 1.5rem 2.5rem;border-radius:16px;min-width:325px;}
    .close-btn{position:absolute;top:0.6rem;right:0.7rem;background:none;border:none;font-size:1.55rem;color:#ff7a7a;line-height:1;cursor:pointer;}
    .records-table {width: 100%; border-collapse: collapse; margin-top: 1rem;}
    .records-table th, .records-table td {padding: 0.75rem; text-align: left; border-bottom: 1px solid #E8E8E8;}
    .records-table th {background: #FFD3D6; font-weight: 600;}
    .records-table tr:hover {background: #f9f9f9;}
    .report-card {background: #fff; border-left: 4px solid #FFB0B5; padding: 1rem; margin-bottom: 1rem; border-radius: 8px;}
    .report-actions {margin-top: 0.5rem;}
    .category-filter {margin-bottom: 1rem;}
    .category-filter select {width: auto; display: inline-block; margin-right: 1rem;}
    @media(max-width:1000px){.stats-grid{grid-template-columns:1fr 1fr;}}
    @media(max-width:700px){.stats-grid{grid-template-columns:1fr;}.tabs{gap:0.45rem;}}
  </style>
  <link rel="stylesheet" href="assets/css/extras.css"/>
</head>
<body>

<!-- CONFIG LOAD (early) -->
<script>window.CONFIG_PRIVATE=undefined;window.CONFIG_PUBLIC=undefined;</script>
<script src="config.private.js?v=2"></script>
<script src="config.js?v=2"></script>
<script>window.CONFIG=window.CONFIG_PRIVATE||window.CONFIG_PUBLIC||{};</script>

<!-- OWNER UID -->
<script>window.OWNER_UID='2ece6eb8-ed7d-4e52-b1b8-f9220fb87e36';</script>

<!-- ADMIN GATE (no backdoors) -->
<script>
(function(){
  try{
    const TTL_MIN=(window.CONFIG?.ADMIN?.SESSION_MINUTES)||30, TTL_MS=TTL_MIN*60*1000;
    function isVerified(){
      const ok=localStorage.getItem('ad-ok')==='1';
      const ts=parseInt(localStorage.getItem('ad-ok-ts')||'0',10);
      const uid=(localStorage.getItem('owner-uid')||'').toLowerCase();
      const match=uid && uid===(window.OWNER_UID||'').toLowerCase();
      const fresh=(Date.now()-ts)<TTL_MS;
      return ok&&fresh&&match;
    }
    window.__isAdminVerified=isVerified;
    if(!isVerified()){
      localStorage.removeItem('ad-ok');
      localStorage.removeItem('ad-ok-ts');
    }
  }catch(e){console.error('[gate-init]',e);}
})();
</script>

<header>
  <div class="container header-content">
    <div class="logo">üõí Aiaxcart Premium</div>
    <nav>
      <ul>
        <li><a href="index.html">Home</a></li>
        <li><a class="active" href="admin.html">Admin</a></li>
      </ul>
    </nav>
  </div>
</header>

<!-- Owner Verification Modal -->
<div class="owner-veri-overlay" id="ownerVeriOverlay">
  <div class="modal-card">
    <button class="close-btn" onclick="closeOwnerModal()">√ó</button>
    <h2>üîê Owner Verification</h2>
    <input id="ownerUidInput" type="text" placeholder="Enter Owner UID" style="width:100%;margin-bottom:1.3rem;"/>
    <button onclick="verifyOwnerUID()" style="background:#FFB0B5;color:white;padding:0.65rem 1.5rem;width:100%;border:none;border-radius:8px;">Verify Access</button>
    <div id="ownerVeriMsg" style="color:red;margin-top:0.8rem;font-size:1.1em;"></div>
  </div>
</div>

<!-- Dashboard -->
<div class="container" id="admin-dashboard" style="display:none;">
  <h1 style="margin-top:2rem;">Admin Console</h1>
  <div class="stats-grid">
    <div class="stat-card"><h3 id="stat-products">0</h3><div>Products</div></div>
    <div class="stat-card"><h3 id="stat-stock">0</h3><div>Available Stock</div></div>
    <div class="stat-card"><h3 id="stat-pending">0</h3><div>Pending Orders</div></div>
    <div class="stat-card"><h3 id="stat-revenue">‚Ç±0</h3><div>Total Revenue</div></div>
  </div>

  <div class="tabs">
    <button class="tab active" data-tab="add-stock">Add Stock</button>
    <button class="tab" data-tab="manage-stocks">Manage Stocks</button>
    <button class="tab" data-tab="pending-orders">Pending Orders</button>
    <button class="tab" data-tab="sold-accounts">Sold Accounts</button>
    <button class="tab" data-tab="archived-stocks">Archived Stocks</button>
    <button class="tab" data-tab="products">Products</button>
    <button class="tab" data-tab="store-rules">Store Rules</button>
    <button class="tab" data-tab="records">Records</button>
    <button class="tab" data-tab="reports">Reports</button>
  </div>

  <!-- Panels -->
  <div class="panel active" id="panel-add-stock">
    <div class="card">
      <h2 id="stock-form-title">Add Stock</h2>
      <form id="addStockForm">
        <input id="stock-edit-id" type="hidden" value=""/>
        <label>Product <select id="stock-product"></select></label>
        <label>Account Type <select id="stock-type"></select></label>
        <label>Duration <select id="stock-duration"></select></label>
        <label>Quantity <input id="stock-qty" type="number" min="1" value="1"/></label>
        <label>Email <input id="stock-email" type="text"/></label>
        <label>Password <input id="stock-password" type="text"/></label>
        <label>Profile <input id="stock-profile" type="text"/></label>
        <label>PIN <input id="stock-pin" type="text"/></label>
        <label>Auto-Archive (Days): <input id="stock-arch" type="number" value="0"/></label>
        <label>Premium At (date, optional): <input id="stock-premdate" type="date"/></label>
        <button id="stock-submit-btn" class="btn btn-primary" type="submit" style="margin-top:1rem;">Add Stock</button>
        <button id="stock-cancel-btn" class="btn btn-warning" type="button" onclick="cancelEditStock()" style="margin-top:1rem; display:none;">Cancel Edit</button>
      </form>
      <div id="add-stock-msg"></div>
    </div>
  </div>

  <div class="panel" id="panel-manage-stocks">
    <div class="card">
      <h2>Manage Stocks</h2>
      <div id="manage-stocks-list"></div>
    </div>
  </div>

  <div class="panel" id="panel-pending-orders">
    <div class="card"><h2>Pending Orders</h2><div id="pending-orders-list"></div></div>
  </div>

  <div class="panel" id="panel-sold-accounts">
    <div class="card"><h2>Sold Accounts</h2><div id="sold-list"></div></div>
  </div>

  <div class="panel" id="panel-archived-stocks">
    <div class="card"><h2>Archived Stocks</h2><div id="archived-list"></div></div>
  </div>

  <div class="panel" id="panel-products">
    <div class="card">
      <h2>Add Product</h2>
      <form id="addProductForm">
        <input id="product-edit-id" type="hidden" value=""/>
        <label>Product Name <input id="product-name" type="text" placeholder="Enter product name" required/></label>
        <label>Category
          <select id="product-category" required>
            <option value="">Select Category</option>
            <option value="entertainment">üé¨ Entertainment</option>
            <option value="streaming">üéµ Music & Streaming</option>
            <option value="educational">üìö Educational</option>
            <option value="editing">üé® Editing Tools</option>
            <option value="ai">ü§ñ AI Tools</option>
          </select>
        </label>
        <label>Icon <input id="product-icon" type="text" placeholder="e.g., üì∫, üéµ, üé®" required/></label>
        <button id="product-submit-btn" class="btn btn-primary" type="submit" style="margin-top:1rem;">Add Product</button>
        <button id="product-cancel-btn" class="btn btn-warning" type="button" onclick="cancelEditProduct()" style="margin-top:1rem; display:none;">Cancel Edit</button>
      </form>
      <div id="add-product-msg"></div>
    </div>
    <div class="card">
      <h2>Products Management</h2>
      <div class="category-filter">
        <label>Filter by Category:
          <select id="product-category-filter" onchange="filterProductsByCategory()">
            <option value="all">All Categories</option>
            <option value="entertainment">üé¨ Entertainment</option>
            <option value="streaming">üéµ Music & Streaming</option>
            <option value="educational">üìö Educational</option>
            <option value="editing">üé® Editing Tools</option>
            <option value="ai">ü§ñ AI Tools</option>
          </select>
        </label>
      </div>
      <div id="products-list"></div>
    </div>
  </div>

  <div class="panel" id="panel-store-rules">
    <div class="card">
      <h2>Add Store Rule</h2>
      <form id="addRuleForm">
        <input id="rule-edit-id" type="hidden" value=""/>
        <label>Product
          <select id="rule-product">
            <option value="general">General (All Products)</option>
          </select>
        </label>
        <label>Rule Text <textarea id="rule-text" rows="3" placeholder="Enter rule description"></textarea></label>
        <button id="rule-submit-btn" class="btn btn-primary" type="submit" style="margin-top:1rem;">Add Rule</button>
        <button id="rule-cancel-btn" class="btn btn-warning" type="button" onclick="cancelEditRule()" style="margin-top:1rem; display:none;">Cancel Edit</button>
      </form>
      <div id="add-rule-msg"></div>
    </div>
    <div class="card"><h2>Store Rules</h2><div id="rules-list"></div></div>
  </div>

  <div class="panel" id="panel-records">
    <div class="card">
      <h2>Add Record</h2>
      <form id="addRecordForm">
        <input id="record-edit-id" type="hidden" value=""/>
        <label>Order ID (Auto-generated for website orders) <input id="record-orderid" type="text" placeholder="Leave empty for auto-generation"/></label>
        <label>Buyer Information <input id="record-buyer" type="text" placeholder="Buyer name or email" required/></label>
        <label>Source
          <select id="record-source" required>
            <option value="">Select Source</option>
            <option value="website">Website</option>
            <option value="facebook">Facebook</option>
            <option value="instagram">Instagram</option>
            <option value="telegram">Telegram</option>
            <option value="tiktok">TikTok</option>
          </select>
        </label>
        <label>Product <select id="record-product" required></select></label>
        <label>Account Type <select id="record-type" required></select></label>
        <label>Duration <select id="record-duration" required></select></label>
        <label>Purchase Date <input id="record-purchasedate" type="date" required/></label>
        <label>Additional Days <input id="record-adddays" type="number" min="0" value="0"/></label>
        <label>Account Details - Email <input id="record-email" type="text"/></label>
        <label>Account Details - Password <input id="record-password" type="text"/></label>
        <label>Account Details - Profile <input id="record-profile" type="text"/></label>
        <label>Account Details - PIN <input id="record-pin" type="text"/></label>
        <label>Price <input id="record-price" type="number" step="0.01" required/></label>
        <button id="record-submit-btn" class="btn btn-primary" type="submit" style="margin-top:1rem;">Add Record</button>
        <button id="record-cancel-btn" class="btn btn-warning" type="button" onclick="cancelEditRecord()" style="margin-top:1rem; display:none;">Cancel Edit</button>
      </form>
      <div id="add-record-msg"></div>
    </div>
    <div class="card">
      <h2>Records List</h2>
      <table class="records-table">
        <thead><tr>
          <th>Order ID</th><th>Buyer/Email</th><th>Source</th><th>Product</th><th>Account Type</th>
          <th>Duration</th><th>Purchase Date</th><th>Expiration Date</th><th>Additional Days</th>
          <th>Updated Expiration</th><th>Account Details</th><th>Price</th><th>Actions</th>
        </tr></thead>
        <tbody id="records-table-body"></tbody>
      </table>
    </div>
  </div>

  <div class="panel" id="panel-reports">
    <div class="card"><h2>Buyer Reports</h2><div id="buyer-reports-list"></div></div>
    <div class="card"><h2>Sales Report</h2><div id="sales-report"></div></div>
  </div>
</div>

<script>
/* ===== Data & Utils ===== */
const ACC_TYPES=["Solo Account","Shared Account","Solo Profile","Shared Profile","Fam Head","Invite","Solo FW","Solo NW","Teamhead Account","Edu Lifetime","Teamhead"];
const DURATIONS=["7d","14d","1m","2m","3m","4m","5m","6m","7m","8m","9m","10m","11m","12m","24m","NW","3m W","6m W","12m W"];

const DEFAULT_PRODUCTS=[{id:'netflix',name:'Netflix Premium',category:'entertainment',icon:'üì∫',stock:0,sold:0},{id:'viu',name:'Viu Premium',category:'entertainment',icon:'üé¨',stock:0,sold:0},{id:'viva-max',name:'VIVAMAX VIVAONE',category:'entertainment',icon:'üé≠',stock:0,sold:0},{id:'wetv',name:'WeTV',category:'entertainment',icon:'üì±',stock:0,sold:0},{id:'iwant-tfc',name:'IWANT TFC',category:'entertainment',icon:'üì∫',stock:0,sold:0},{id:'crunchyroll',name:'Crunchyroll',category:'entertainment',icon:'üéÆ',stock:0,sold:0},{id:'disney-plus',name:'Disney+',category:'entertainment',icon:'ü¶Å',stock:0,sold:0},{id:'bilibili',name:'Bilibili',category:'entertainment',icon:'üì∫',stock:0,sold:0},{id:'loklok',name:'Loklok',category:'entertainment',icon:'üì±',stock:0,sold:0},{id:'iqiyi',name:'iQiyi',category:'entertainment',icon:'üì∫',stock:0,sold:0},{id:'hbo-max',name:'HBO Max',category:'entertainment',icon:'üìπ',stock:0,sold:0},{id:'amazon-prime',name:'Amazon Prime',category:'entertainment',icon:'üõí',stock:0,sold:0},{id:'youku',name:'Youku',category:'entertainment',icon:'üì∫',stock:0,sold:0},{id:'nba-league-pass',name:'NBA League Pass Premium',category:'entertainment',icon:'üèÄ',stock:0,sold:0},{id:'youtube',name:'YouTube Premium',category:'streaming',icon:'üìπ',stock:0,sold:0},{id:'spotify',name:'Spotify Premium',category:'streaming',icon:'üéµ',stock:0,sold:0},{id:'apple-music',name:'Apple Music',category:'streaming',icon:'üéß',stock:0,sold:0},{id:'chatgpt',name:'ChatGPT Plus',category:'ai',icon:'üß†',stock:0,sold:0},{id:'blackbox-ai',name:'Blackbox AI',category:'ai',icon:'ü§ñ',stock:0,sold:0},{id:'perplexity',name:'Perplexity AI',category:'ai',icon:'üîç',stock:0,sold:0},{id:'google-one',name:'Google One + Gemini AI',category:'ai',icon:'‚òÅÔ∏è',stock:0,sold:0},{id:'quizlet',name:'Quizlet+',category:'educational',icon:'üìö',stock:0,sold:0},{id:'scribd',name:'Scribd Premium',category:'educational',icon:'üìñ',stock:0,sold:0},{id:'studocu',name:'Studocu Premium',category:'educational',icon:'üéì',stock:0,sold:0},{id:'duolingo',name:'Duolingo Super',category:'educational',icon:'üßë‚Äçüéì',stock:0,sold:0},{id:'turnitin-student',name:'Turnitin Student',category:'educational',icon:'üìù',stock:0,sold:0},{id:'turnitin-instructor',name:'Turnitin Instructor',category:'educational',icon:'üë®‚Äçüè´',stock:0,sold:0},{id:'canva',name:'Canva Pro',category:'editing',icon:'üé®',stock:0,sold:0},{id:'picsart',name:'Picsart Gold',category:'editing',icon:'üëè',stock:0,sold:0},{id:'capcut',name:'CapCut Pro',category:'editing',icon:'üìù',stock:0,sold:0},{id:'alight-motion',name:'Alight Motion Pro',category:'editing',icon:'üì±',stock:0,sold:0},{id:'remini',name:'Remini Web',category:'editing',icon:'‚ú®',stock:0,sold:0},{id:'grammarly',name:'Grammarly Premium',category:'educational',icon:'‚úçÔ∏è',stock:0,sold:0},{id:'quillbot',name:'Quillbot Premium',category:'educational',icon:'üìù',stock:0,sold:0},{id:'ms-365',name:'Microsoft 365',category:'educational',icon:'ü§¨',stock:0,sold:0},{id:'cams-canner',name:'CamScanner Pro',category:'editing',icon:'üìÅ',stock:0,sold:0},{id:'small-pdf',name:'Small PDF Pro',category:'editing',icon:'üìÅ',stock:0,sold:0},{id:'zoom',name:'Zoom Pro',category:'educational',icon:'üìΩÔ∏è',stock:0,sold:0}];

let stocks=JSON.parse(localStorage.getItem("stocks")||"[]");
let products=JSON.parse(localStorage.getItem("products")||"[]");
let rules=JSON.parse(localStorage.getItem("rules")||"[]");
let records=JSON.parse(localStorage.getItem("records")||"[]");
let archived=JSON.parse(localStorage.getItem("archived")||"[]");
let sold=JSON.parse(localStorage.getItem("sold")||"[]");
let pending=JSON.parse(localStorage.getItem("pending")||"[]");
let buyerReports=JSON.parse(localStorage.getItem("buyerReports")||"[]");

if(products.length===0){products=DEFAULT_PRODUCTS;localStorage.setItem("products",JSON.stringify(products));}
if(rules.length===0){
  rules=[{id:genId(),product:"general",text:"All accounts are premium quality"},{id:genId(),product:"general",text:"No refunds after delivery"},{id:genId(),product:"general",text:"Replacement guaranteed within 24 hours for any issues"},{id:genId(),product:"Netflix Premium",text:"No password changing allowed"},{id:genId(),product:"Netflix Premium",text:"Use only on one device at a time"}];
  localStorage.setItem("rules",JSON.stringify(rules));
}

function saveAll(){localStorage.setItem("stocks",JSON.stringify(stocks));localStorage.setItem("products",JSON.stringify(products));localStorage.setItem("rules",JSON.stringify(rules));localStorage.setItem("records",JSON.stringify(records));localStorage.setItem("archived",JSON.stringify(archived));localStorage.setItem("sold",JSON.stringify(sold));localStorage.setItem("pending",JSON.stringify(pending));localStorage.setItem("buyerReports",JSON.stringify(buyerReports));}
function genId(){return Date.now()+'-'+Math.random().toString(36).substr(2,9);}
function genOrderId(){return 'ORD-'+Date.now()+'-'+Math.random().toString(36).substr(2,9).toUpperCase();}
function calcExp(purchaseDate,duration,additionalDays=0){const d=new Date(purchaseDate);let add=additionalDays;if(typeof duration==='string'){if(duration.endsWith('d'))add+=parseInt(duration);else if(duration.endsWith('m'))add+=parseInt(duration)*30;else if(duration.endsWith('W'))add+=parseInt(duration)*7;}d.setDate(d.getDate()+add);return d.toISOString().split('T')[0];}
function fmtDetails(r){let a=[];if(r.email)a.push(`Email: ${r.email}`);if(r.password)a.push(`Password: ${r.password}`);if(r.profile)a.push(`Profile: ${r.profile}`);if(r.pin)a.push(`PIN: ${r.pin}`);return a.join('<br>');}

/* ===== Owner Verify ===== */
function openOwnerModal(){document.getElementById('ownerUidInput').value='';document.getElementById('ownerVeriMsg').textContent='';document.getElementById("ownerVeriOverlay").style.display="flex";}
function closeOwnerModal(){document.getElementById("ownerVeriOverlay").style.display="none";}
function verifyOwnerUID(){
  const uid=(document.getElementById('ownerUidInput').value||'').trim();
  if(uid.toLowerCase()===(window.OWNER_UID||'').toLowerCase()){
    localStorage.setItem('owner-uid',uid);
    localStorage.setItem('ad-ok','1');
    localStorage.setItem('ad-ok-ts',Date.now().toString());
    closeOwnerModal(); showAdminPanel(); initializeAdmin();
  }else{document.getElementById('ownerVeriMsg').innerText='‚ùå Invalid UID.';}
}

/* ===== Renders ===== */
function updateStats(){document.getElementById("stat-products").innerText=products.length;document.getElementById("stat-stock").innerText=stocks.filter(s=>s.status==='available').length;document.getElementById("stat-pending").innerText=pending.length;const rev=sold.reduce((a,b)=>a+(+b.price||0),0)+records.reduce((a,b)=>a+(+b.price||0),0);document.getElementById("stat-revenue").innerText="‚Ç±"+rev;}
function showStocks(){const list=document.getElementById("manage-stocks-list"),avail=stocks.filter(s=>s.status==='available');list.innerHTML=avail.length?avail.map(st=>`<div class="stock-card"><div><b>${st.product}</b> ${st.type} (${st.duration})</div><div>Email: ${st.email||'N/A'} | Profile: ${st.profile||'N/A'}</div><div class="stock-actions"><button class="btn btn-info btn-small" onclick="editStock('${st.id}')">Edit</button><button class="btn btn-success btn-small" onclick="markSold('${st.id}')">Mark Sold</button><button class="btn btn-warning btn-small" onclick="archiveStock('${st.id}')">Archive</button><button class="btn btn-danger btn-small" onclick="delStock('${st.id}')">Delete</button></div></div>`).join(''):"No available stocks.";}
function showProducts(){const f=document.getElementById("product-category-filter").value;const arr=(f==='all')?products:products.filter(p=>p.category===f);document.getElementById("products-list").innerHTML=arr.length?arr.map(p=>`<div class="stock-card"><div><b>${p.icon} ${p.name}</b></div><div>Category: ${p.category} | Stock: ${p.stock} | Sold: ${p.sold}</div><div class="stock-actions"><button class="btn btn-info btn-small" onclick="editProduct('${p.id}')">Edit</button><button class="btn btn-danger btn-small" onclick="delProduct('${p.id}')">Delete</button></div></div>`).join(''):"No products found for this category.";}
function filterProductsByCategory(){showProducts();}
function showRecords(){const tb=document.getElementById("records-table-body");tb.innerHTML=records.length?records.map(r=>`<tr><td>${r.orderId}</td><td>${r.buyer}</td><td>${r.source}</td><td>${r.product}</td><td>${r.accountType}</td><td>${r.duration}</td><td>${r.purchaseDate}</td><td>${r.expirationDate}</td><td>${r.additionalDays}</td><td>${r.updatedExpiration}</td><td>${fmtDetails(r)}</td><td>‚Ç±${r.price}</td><td><button class="btn btn-info btn-small" onclick="editRecord('${r.id}')">Edit</button><button class="btn btn-danger btn-small" onclick="removeRecord('${r.id}')">Remove</button></td></tr>`).join(''):'<tr><td colspan="13" style="text-align:center;">No records found.</td></tr>';}
function showRules(){const el=document.getElementById("rules-list");el.innerHTML=rules.length?rules.map(rule=>`<div class="stock-card"><div><b>Product:</b> ${rule.product==='general'?'All Products':rule.product}</div><div><b>Rule:</b> ${rule.text}</div><div class="stock-actions"><button class="btn btn-info btn-small" onclick="editRule('${rule.id}')">Edit</button><button class="btn btn-danger btn-small" onclick="delRule('${rule.id}')">Remove</button></div></div>`).join(''):"No rules defined.";}
function showReports(){const list=document.getElementById("buyer-reports-list");list.innerHTML=buyerReports.length?buyerReports.map(r=>`<div class="report-card"><div><b>Report ID:</b> ${r.id}</div><div><b>Order ID:</b> ${r.orderId||'N/A'}</div><div><b>Buyer:</b> ${r.buyer}</div><div><b>Product:</b> ${r.product}</div><div><b>Issue:</b> ${r.issue}</div><div><b>Status:</b> <span class="badge ${r.status==='resolved'?'badge-resolved':'badge-pending'}">${r.status}</span></div><div><b>Date Reported:</b> ${r.date}</div><div class="report-actions">${r.status!=='resolved'?`<button class="btn btn-success btn-small" onclick="resolveReport('${r.id}')">Mark Resolved</button>`:''}<button class="btn btn-danger btn-small" onclick="deleteReport('${r.id}')">Delete</button></div></div>`).join(''):'<p>No buyer reports yet.</p>';const total=records.reduce((a,b)=>a+(+b.price||0),0);const web=records.filter(r=>r.source==='website').length;const soc=records.filter(r=>r.source!=='website').length;document.getElementById("sales-report").innerHTML=`<p><b>Total Records:</b> ${records.length}</p><p><b>Total Revenue:</b> ‚Ç±${total}</p><p><b>Website Orders:</b> ${web}</p><p><b>Social Media Orders:</b> ${soc}</p><p><b>Pending Buyer Reports:</b> ${buyerReports.filter(r=>r.status==='pending').length}</p>`;}
function showArchived(){document.getElementById("archived-list").innerHTML=archived.length?archived.map(a=>`<div>${a.product}, ${a.type}, archived at: ${a.archivedAt}</div>`).join(''):"No archived stocks";}
function showPending(){document.getElementById("pending-orders-list").innerHTML=pending.length?pending.map(p=>`<div>${p.product}, order: ${p.orderId}</div>`).join(''):"No pending orders.";}
function showSold(){document.getElementById("sold-list").innerHTML=sold.length?sold.map(x=>`<div>${x.product}, buyer, price ‚Ç±${x.price||0}</div>`).join(''):"No sold accounts yet";}

/* ===== Actions ===== */
function editStock(id){const s=stocks.find(x=>x.id===id); if(!s) return;
  document.getElementById("stock-edit-id").value=s.id;
  document.getElementById("stock-product").value=s.product;
  document.getElementById("stock-type").value=s.type;
  document.getElementById("stock-duration").value=s.duration;
  document.getElementById("stock-email").value=s.email||'';
  document.getElementById("stock-password").value=s.password||'';
  document.getElementById("stock-profile").value=s.profile||'';
  document.getElementById("stock-pin").value=s.pin||'';
  document.getElementById("stock-arch").value=s.archiveAfter||0;
  document.getElementById("stock-premdate").value=s.premiumAt||'';
  document.getElementById("stock-form-title").textContent="Edit Stock";
  document.getElementById("stock-submit-btn").textContent="Update Stock";
  document.getElementById("stock-cancel-btn").style.display="inline-block";
  document.getElementById("stock-qty").style.display="none";
  const qtyLbl=[...document.querySelectorAll('#addStockForm label')].find(l=>l.textContent.trim().startsWith('Quantity')); if(qtyLbl) qtyLbl.style.display='none';
  document.querySelectorAll(".tab").forEach(t=>t.classList.remove("active")); document.querySelectorAll(".panel").forEach(p=>p.classList.remove("active"));
  document.querySelector('.tab[data-tab="add-stock"]').classList.add("active"); document.getElementById("panel-add-stock").classList.add("active");
}
function cancelEditStock(){document.getElementById("stock-edit-id").value="";document.getElementById("addStockForm").reset();document.getElementById("stock-form-title").textContent="Add Stock";document.getElementById("stock-submit-btn").textContent="Add Stock";document.getElementById("stock-cancel-btn").style.display="none";document.getElementById("stock-qty").style.display="block";const l=[...document.querySelectorAll('#addStockForm label')].find(x=>x.textContent.trim().startsWith('Quantity')); if(l) l.style.display='block';}
function delStock(id){if(!confirm('Delete this stock?'))return;stocks=stocks.filter(s=>s.id!==id);saveAll();showStocks();updateStats();}
function archiveStock(id){const i=stocks.findIndex(s=>s.id==id);if(i>-1){archived.push({...stocks[i],archivedAt:(new Date()).toLocaleDateString()});stocks.splice(i,1);saveAll();showStocks();showArchived();}}
function markSold(id){const s=stocks.find(x=>x.id==id); if(!s) return; const now=new Date(); const rec={id:genId(),orderId:genOrderId(),buyer:'Website Customer',source:'website',product:s.product,accountType:s.type,duration:s.duration,purchaseDate:now.toISOString().split('T')[0],expirationDate:calcExp(now,s.duration),additionalDays:0,updatedExpiration:calcExp(now,s.duration,0),email:s.email,password:s.password,profile:s.profile,pin:s.pin,price:199,status:'sold',createdAt:now.toISOString()};records.push(rec);sold.push({...s,price:199,soldDate:now.toLocaleDateString()});stocks=stocks.filter(x=>x.id!==id);saveAll();updateStats();showStocks();showSold();showRecords();}
function editProduct(id){const p=products.find(x=>x.id===id); if(!p) return;document.getElementById("product-edit-id").value=p.id;document.getElementById("product-name").value=p.name;document.getElementById("product-category").value=p.category;document.getElementById("product-icon").value=p.icon;document.getElementById("product-submit-btn").textContent="Update Product";document.getElementById("product-cancel-btn").style.display="inline-block";document.querySelectorAll(".tab").forEach(t=>t.classList.remove("active"));document.querySelectorAll(".panel").forEach(pn=>pn.classList.remove("active"));document.querySelector('.tab[data-tab="products"]').classList.add("active");document.getElementById("panel-products").classList.add("active");}
function cancelEditProduct(){document.getElementById("product-edit-id").value="";document.getElementById("addProductForm").reset();document.getElementById("product-submit-btn").textContent="Add Product";document.getElementById("product-cancel-btn").style.display="none";}
function delProduct(id){if(!confirm('Delete this product?'))return;products=products.filter(p=>p.id!==id);saveAll();updateProductDropdowns();updateRuleProductDropdown();showProducts();updateStats();}
function editRecord(id){const r=records.find(x=>x.id===id); if(!r) return;document.getElementById("record-edit-id").value=r.id;document.getElementById("record-orderid").value=r.orderId;document.getElementById("record-buyer").value=r.buyer;document.getElementById("record-source").value=r.source;document.getElementById("record-product").value=r.product;document.getElementById("record-type").value=r.accountType;document.getElementById("record-duration").value=r.duration;document.getElementById("record-purchasedate").value=r.purchaseDate;document.getElementById("record-adddays").value=r.additionalDays;document.getElementById("record-email").value=r.email||'';document.getElementById("record-password").value=r.password||'';document.getElementById("record-profile").value=r.profile||'';document.getElementById("record-pin").value=r.pin||'';document.getElementById("record-price").value=r.price;document.getElementById("record-submit-btn").textContent="Update Record";document.getElementById("record-cancel-btn").style.display="inline-block";document.getElementById("addRecordForm").scrollIntoView();document.getElementById("add-record-msg").textContent="Editing record. Update then click 'Update Record'.";}
function cancelEditRecord(){document.getElementById("record-edit-id").value="";document.getElementById("addRecordForm").reset();document.getElementById("record-purchasedate").value=new Date().toISOString().split('T')[0];document.getElementById("record-submit-btn").textContent="Add Record";document.getElementById("record-cancel-btn").style.display="none";document.getElementById("add-record-msg").textContent="";}
function delRule(id){if(!confirm('Remove this rule?'))return;rules=rules.filter(r=>r.id!==id);saveAll();showRules();}
function removeRecord(id){if(!confirm('Remove this record?'))return;records=records.filter(r=>r.id!==id);saveAll();showRecords();updateStats();}
function resolveReport(id){const i=buyerReports.findIndex(r=>r.id===id);if(i>-1){buyerReports[i].status='resolved';saveAll();showReports();}}
function deleteReport(id){if(!confirm('Delete this report?'))return;buyerReports=buyerReports.filter(r=>r.id!==id);saveAll();showReports();}
function addBuyerReport(report){buyerReports.push({id:genId(),...report,status:'pending',date:new Date().toLocaleDateString()});saveAll();showReports();}
function processWebsiteOrder(orderData){pending.push({id:genId(),...orderData,timestamp:new Date().toISOString(),status:'pending'});const p=products.find(x=>x.name===orderData.productName);if(p){p.stock=Math.max(0,p.stock-1);p.sold+=1;}saveAll();updateStats();showPending();showProducts();return{success:true,orderId:orderData.orderId,message:'Order processed successfully'};}

/* ===== Init & Forms ===== */
function updateProductDropdowns(){const s1=document.getElementById("stock-product"),s2=document.getElementById("record-product");if(s1)s1.innerHTML=products.map(p=>`<option value="${p.name}">${p.name}</option>`).join('');if(s2)s2.innerHTML=products.map(p=>`<option value="${p.name}">${p.name}</option>`).join('');}
function updateRuleProductDropdown(){const sel=document.getElementById("rule-product");if(!sel)return;sel.innerHTML='<option value="general">General (All Products)</option>'+products.map(p=>`<option value="${p.name}">${p.name}</option>`).join('');}
function setupFormSubmissions(){
  document.getElementById("addStockForm").onsubmit=function(e){e.preventDefault();const editId=document.getElementById("stock-edit-id").value;if(editId){const i=stocks.findIndex(s=>s.id===editId);if(i>-1){stocks[i]={...stocks[i],product:document.getElementById("stock-product").value,type:document.getElementById("stock-type").value,duration:document.getElementById("stock-duration").value,email:document.getElementById("stock-email").value,password:document.getElementById("stock-password").value,profile:document.getElementById("stock-profile").value,pin:document.getElementById("stock-pin").value,archiveAfter:Number(document.getElementById("stock-arch").value)||0,premiumAt:document.getElementById("stock-premdate").value||""};saveAll();showStocks();document.getElementById("add-stock-msg").textContent="‚úî Stock Updated!";cancelEditStock();}}else{let qty=Number(document.getElementById("stock-qty").value)||1;for(let i=0;i<qty;i++){stocks.push({id:genId(),product:document.getElementById("stock-product").value,type:document.getElementById("stock-type").value,duration:document.getElementById("stock-duration").value,email:document.getElementById("stock-email").value,password:document.getElementById("stock-password").value,profile:document.getElementById("stock-profile").value,pin:document.getElementById("stock-pin").value,archiveAfter:Number(document.getElementById("stock-arch").value)||0,premiumAt:document.getElementById("stock-premdate").value||"",status:'available'});}saveAll();this.reset();updateStats();showStocks();document.getElementById("add-stock-msg").textContent="‚úî Stock Added!";}setTimeout(()=>document.getElementById("add-stock-msg").textContent='',1500);};
  document.getElementById("addProductForm").onsubmit=function(e){e.preventDefault();const editId=document.getElementById("product-edit-id").value;const name=document.getElementById("product-name").value;const category=document.getElementById("product-category").value;const icon=document.getElementById("product-icon").value;if(editId){const i=products.findIndex(p=>p.id===editId);if(i>-1){products[i]={...products[i],name,category,icon};saveAll();updateProductDropdowns();updateRuleProductDropdown();showProducts();document.getElementById("add-product-msg").textContent="‚úî Product Updated!";cancelEditProduct();}}else{products.push({id:genId(),name,category,icon,stock:0,sold:0});saveAll();this.reset();updateProductDropdowns();updateRuleProductDropdown();showProducts();document.getElementById("add-product-msg").textContent="‚úî Product Added!";}setTimeout(()=>document.getElementById("add-product-msg").textContent='',1500);};
  document.getElementById("addRecordForm").onsubmit=function(e){e.preventDefault();const editId=document.getElementById("record-edit-id").value;const pd=document.getElementById("record-purchasedate").value;const dur=document.getElementById("record-duration").value;const add=Number(document.getElementById("record-adddays").value)||0;if(editId){const i=records.findIndex(r=>r.id===editId);if(i>-1){records[i]={...records[i],orderId:document.getElementById("record-orderid").value,buyer:document.getElementById("record-buyer").value,source:document.getElementById("record-source").value,product:document.getElementById("record-product").value,accountType:document.getElementById("record-type").value,duration:dur,purchaseDate:pd,expirationDate:calcExp(pd,dur),additionalDays:add,updatedExpiration:calcExp(pd,dur,add),email:document.getElementById("record-email").value,password:document.getElementById("record-password").value,profile:document.getElementById("record-profile").value,pin:document.getElementById("record-pin").value,price:Number(document.getElementById("record-price").value)||0};saveAll();showRecords();document.getElementById("add-record-msg").textContent="‚úî Record Updated!";cancelEditRecord();}}else{records.push({id:genId(),orderId:document.getElementById("record-orderid").value||genOrderId(),buyer:document.getElementById("record-buyer").value,source:document.getElementById("record-source").value,product:document.getElementById("record-product").value,accountType:document.getElementById("record-type").value,duration:dur,purchaseDate:pd,expirationDate:calcExp(pd,dur),additionalDays:add,updatedExpiration:calcExp(pd,dur,add),email:document.getElementById("record-email").value,password:document.getElementById("record-password").value,profile:document.getElementById("record-profile").value,pin:document.getElementById("record-pin").value,price:Number(document.getElementById("record-price").value)||0,status:'active',createdAt:new Date().toISOString()});saveAll();this.reset();document.getElementById("record-purchasedate").value=new Date().toISOString().split('T')[0];showRecords();updateStats();document.getElementById("add-record-msg").textContent="‚úî Record Added!";}setTimeout(()=>document.getElementById("add-record-msg").textContent='',1500);};
}

/* ===== Initialize ===== */
function showAdminPanel(){document.getElementById('admin-dashboard').style.display='block';updateStats();showStocks();showArchived();showProducts();showRules();showRecords();showReports();showPending();showSold();}
function initializeAdmin(){const tabs=document.querySelectorAll(".tab"),panels=document.querySelectorAll(".panel");tabs.forEach(t=>{t.onclick=function(){tabs.forEach(x=>x.classList.remove("active"));panels.forEach(x=>x.classList.remove("active"));t.classList.add("active");document.getElementById("panel-"+t.dataset.tab).classList.add("active");};});function fill(id,arr){const el=document.getElementById(id);if(el)el.innerHTML=arr.map(x=>`<option value="${x}">${x}</option>`).join('');}fill("stock-type",ACC_TYPES);fill("stock-duration",DURATIONS);fill("record-type",ACC_TYPES);fill("record-duration",DURATIONS);updateProductDropdowns();updateRuleProductDropdown();document.getElementById("record-purchasedate").value=new Date().toISOString().split('T')[0];setupFormSubmissions();}
document.addEventListener("DOMContentLoaded",function(){if(window.__isAdminVerified&&window.__isAdminVerified()){showAdminPanel();initializeAdmin();}else{openOwnerModal();}});

/* ===== Session refresh & expiry ===== */
(function(){const TTL_MIN=(window.CONFIG?.ADMIN?.SESSION_MINUTES)||30,TTL_MS=TTL_MIN*60*1000;function touch(){if(window.__isAdminVerified&&window.__isAdminVerified()){localStorage.setItem('ad-ok-ts',Date.now().toString());}}['click','keydown','mousemove','scroll','touchstart','visibilitychange'].forEach(e=>window.addEventListener(e,touch,{passive:true}));setInterval(()=>{if(!(window.__isAdminVerified&&window.__isAdminVerified())){const dash=document.getElementById('admin-dashboard');if(dash)dash.style.display='none';openOwnerModal();}},60*1000);})();
</script>

<!-- Optional libs -->
<script src="https://unpkg.com/@supabase/supabase-js@2"></script>
<script src="assets/js/aiaxcart/supabase.js?v=2"></script>
</body>
</html>