<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1.0"/>
<title>Aiaxcart Premium Shop</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<style>
  :root {
    --primary: #FF6B8B;
    --secondary: #FFD3D6;
    --accent: #9C4DF4;
    --dark: #5a3e36;
    --light: #fefaf7;
    --success: #28a745;
    --warning: #ff9800;
    --danger: #e74c3c;
    --card-bg: #ffffff;
    --shadow: 0 4px 15px rgba(0,0,0,.08);
  }
  
  body {
    background: var(--light);
    color: var(--dark);
    font-family: 'Segoe UI', Tahoma, Verdana, sans-serif;
    margin: 0;
    line-height: 1.6;
  }
  
  /* Header Styles */
  header {
    background: var(--secondary);
    box-shadow: var(--shadow);
    position: sticky;
    top: 0;
    z-index: 100;
  }
  
  .container {
    max-width: 1200px;
    margin: 0 auto;
    padding: 0 20px;
  }
  
  .header-content {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 1rem 0;
  }
  
  .logo {
    font-size: 1.5rem;
    font-weight: 700;
    color: var(--dark);
    display: flex;
    align-items: center;
    gap: 0.5rem;
  }
  
  nav ul {
    display: flex;
    gap: 1rem;
    margin: 0;
    padding: 0;
    list-style: none;
  }
  
  nav a {
    color: var(--dark);
    text-decoration: none;
    padding: .5rem 1rem;
    border-radius: 8px;
    transition: all 0.3s ease;
  }
  
  nav a.active, nav a:hover {
    background: var(--primary);
    color: white;
  }
  
  .user-info {
    display: none;
    align-items: center;
    gap: .7rem;
  }
  
  .user-avatar {
    width: 36px;
    height: 36px;
    border-radius: 50%;
    background: var(--primary);
    display: grid;
    place-items: center;
    font-weight: 700;
    color: white;
  }
  
  /* Tabs */
  .tabs {
    display: flex;
    gap: .4rem;
    background: #fff;
    border-radius: 0 0 12px 12px;
    padding: .5rem;
    box-shadow: var(--shadow);
    border-top: 1px solid #F9E6E4;
    overflow-x: auto;
  }
  
  .tab {
    padding: .6rem 1rem;
    border-radius: 10px;
    white-space: nowrap;
    cursor: pointer;
    transition: all 0.3s ease;
  }
  
  .tab.active {
    background: var(--primary);
    color: white;
  }
  
  /* Category Sections */
  .category-section {
    margin: 2.5rem 0;
  }
  
  .section-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 1.5rem;
    padding-bottom: 0.5rem;
    border-bottom: 2px solid var(--secondary);
  }
  
  .section-title {
    margin: 0;
    color: var(--dark);
    font-size: 1.5rem;
  }
  
  .view-all {
    color: var(--primary);
    text-decoration: none;
    font-weight: 600;
    display: flex;
    align-items: center;
    gap: 0.3rem;
    transition: all 0.3s ease;
  }
  
  .view-all:hover {
    color: var(--accent);
    transform: translateX(3px);
  }
  
  /* Products Grid */
  .products-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
    gap: 1.5rem;
  }
  
  .p-card {
    background: var(--card-bg);
    border-radius: 12px;
    padding: 1.5rem;
    box-shadow: var(--shadow);
    transition: transform 0.3s ease, box-shadow 0.3s ease;
    position: relative;
  }
  
  .p-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 8px 25px rgba(0,0,0,.12);
  }
  
  .p-card h3 {
    margin-top: 0;
    margin-bottom: 0.5rem;
    font-size: 1.2rem;
  }
  
  .p-card .price {
    font-weight: 700;
    color: var(--primary);
    margin-bottom: 1rem;
    font-size: 1.3rem;
  }
  
  .p-card .description {
    color: #666;
    margin-bottom: 1rem;
    font-size: 0.9rem;
  }
  
  .stock-badge {
    display: inline-block;
    padding: 0.3rem 0.7rem;
    border-radius: 999px;
    font-size: 0.8rem;
    font-weight: 600;
    margin-bottom: 1rem;
  }
  
  .in-stock {
    background: rgba(40, 167, 69, 0.1);
    color: var(--success);
  }
  
  .out-of-stock {
    background: rgba(108, 117, 125, 0.1);
    color: #6c757d;
  }
  
  .btn {
    padding: .75rem 1.5rem;
    border: none;
    border-radius: 10px;
    cursor: pointer;
    font-weight: 600;
    transition: all 0.3s ease;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    gap: 0.5rem;
    width: 100%;
  }
  
  .btn-primary {
    background: var(--primary);
    color: white;
  }
  
  .btn-primary:hover {
    background: #ff4d6d;
    transform: translateY(-2px);
  }
  
  .btn-primary:disabled {
    background: #ddd;
    color: #777;
    cursor: not-allowed;
    transform: none;
  }
  
  .card {
    background: var(--card-bg);
    border-radius: 12px;
    padding: 1.5rem;
    box-shadow: var(--shadow);
    margin: 1.5rem 0;
  }
  
  .search-wrap {
    margin: 1rem 0;
    position: relative;
  }
  
  .search-wrap input {
    width: 100%;
    padding: .8rem 1rem .8rem 2.4rem;
    border: 1px solid #F9E6E4;
    border-radius: 10px;
    font-size: 1rem;
    transition: border 0.3s ease;
  }
  
  .search-wrap input:focus {
    outline: none;
    border-color: var(--primary);
  }
  
  .search-wrap span {
    position: absolute;
    left: .8rem;
    top: 50%;
    transform: translateY(-50%);
    color: #777;
  }
  
  .pill {
    display: inline-block;
    padding: .2rem .6rem;
    border-radius: 999px;
    background: #fff3cd;
    color: #856404;
    font-size: .8rem;
    font-weight: 700;
  }
  
  footer {
    background: var(--dark);
    color: #fff;
    text-align: center;
    padding: 1.5rem 0;
    margin-top: 3rem;
  }
  
  #toast {
    position: fixed;
    right: 16px;
    bottom: 16px;
    display: grid;
    gap: 8px;
    z-index: 99999;
  }
  
  .toast {
    background: #333;
    color: #fff;
    padding: .7rem 1rem;
    border-radius: 10px;
    box-shadow: 0 6px 20px rgba(0,0,0,.15);
    opacity: .98;
    max-width: 300px;
  }
  
  .toast.ok {
    background: var(--success);
  }
  
  .toast.warn {
    background: var(--warning);
  }
  
  .toast.err {
    background: var(--danger);
  }
  
  .note {
    font-size: .85rem;
    opacity: .8;
  }
  
  /* Category Tabs */
  .category-tabs {
    display: flex;
    gap: 0.5rem;
    margin: 1.5rem 0;
    overflow-x: auto;
    padding-bottom: 0.5rem;
  }
  
  .category-tab {
    padding: 0.6rem 1.2rem;
    border-radius: 999px;
    background: var(--card-bg);
    border: 1px solid #F9E6E4;
    cursor: pointer;
    white-space: nowrap;
    transition: all 0.3s ease;
  }
  
  .category-tab.active {
    background: var(--primary);
    color: white;
    border-color: var(--primary);
  }
  
  /* Responsive */
  @media (max-width: 768px) {
    .header-content {
      flex-direction: column;
      gap: 1rem;
    }
    
    nav ul {
      flex-wrap: wrap;
      justify-content: center;
    }
    
    .products-grid {
      grid-template-columns: 1fr;
    }
    
    .section-header {
      flex-direction: column;
      align-items: flex-start;
      gap: 1rem;
    }
    
    .tabs {
      flex-wrap: wrap;
    }
  }
</style>
</head>
<body>
<div id="toast"></div>
<header>
  <div class="container header-content">
    <div class="logo">
      <i class="fas fa-crown"></i>
      <span>Aiaxcart Premium</span>
    </div>
    <nav>
      <ul>
        <li><a class="active" href="index.html">Home</a></li>
        <li><a id="admin-btn" href="admin.html">Admin</a></li>
      </ul>
    </nav>
    <div id="auth-buttons">
      <button class="btn" id="login-btn">Login / Sign up</button>
    </div>
    <div id="user-info" class="user-info">
      <div id="user-avatar" class="user-avatar"></div>
      <span id="user-name"></span>
      <button class="btn" id="logout-btn">Logout</button>
    </div>
  </div>
  <div class="container tabs">
    <div class="tab active" data-tab="products">Products</div>
    <div class="tab" data-tab="accounts">My Account</div>
    <div class="tab" data-tab="reports">Report Issue</div>
    <div class="tab" data-tab="payments">Payments</div>
    <div class="tab" data-tab="rules">Rules</div>
    <div class="tab" data-tab="feedback">Feedback</div>
    <div class="tab" data-tab="about">About</div>
  </div>
</header>

<main class="container">
  <div class="search-wrap">
    <span><i class="fas fa-search"></i></span>
    <input id="product-search" placeholder="Search productsâ€¦"/>
  </div>

  <!-- Category Tabs -->
  <div class="category-tabs" id="category-tabs">
    <div class="category-tab active" data-category="all">All Categories</div>
    <div class="category-tab" data-category="entertainment">ðŸŽ¬ Entertainment</div>
    <div class="category-tab" data-category="streaming">ðŸŽ§ Streaming</div>
    <div class="category-tab" data-category="educational">ðŸ“š Educational</div>
    <div class="category-tab" data-category="editing">ðŸŽ¨ Editing</div>
    <div class="category-tab" data-category="ai">ðŸ¤– AI</div>
  </div>

  <section id="products-section" style="margin-top:1.5rem">
    <!-- Categories will be dynamically generated here -->
    <div id="categories-container"></div>
  </section>

  <!-- Other sections remain the same -->
  <section id="accounts-content" class="card" style="display:none"></section>

  <section id="reports-content" class="card" style="display:none">
    <h3>Report an Issue</h3>
    <div id="report-gate" class="note">Please login to report an issue.</div>
    <div id="report-form" style="display:none">
      <div class="row"><label>Order (optional)</label><input id="rep-order"></div>
      <div class="row"><label>Product</label><input id="rep-product"></div>
      <div class="row"><label>Issue</label><textarea id="rep-issue" rows="3"></textarea></div>
      <div class="row"><label>Attach image</label><input id="rep-img" type="file" accept="image/*"></div>
      <button class="btn btn-primary" id="rep-submit">Submit Report</button>
    </div>
    <div id="my-reports" style="margin-top:1rem"></div>
  </section>

  <section id="payments-content" class="card" style="display:none">
    <h3>Payment Methods</h3>
    <p>GCash: <b>0962 554 4105</b></p>
    <p>Maya: <b>0929 984 3629</b></p>
  </section>

  <section id="rules-content" class="card" style="display:none">
    <h3>Store Rules</h3>
    <div class="row"><input id="rules-search" placeholder="Search rulesâ€¦"></div>
    <div id="rules-wrap"></div>
  </section>

  <section id="feedback-content" class="card" style="display:none">
    <h3>Customer Feedback</h3>
    <div id="fb-gate" class="note">Please login to leave feedback.</div>
    <div id="fb-form" style="display:none">
      <div class="row"><label>Your feedback</label><textarea id="fb-text" rows="3"></textarea></div>
      <div class="row"><label>Attach image (optional)</label><input id="fb-img" type="file" accept="image/*"></div>
      <button class="btn btn-primary" id="fb-submit">Submit</button>
    </div>
    <div id="fb-list" style="margin-top:1rem"></div>
  </section>

  <section id="about-content" class="card" style="display:none">
    <p>Aiaxcart Premium â€” Your trusted source for premium digital accounts.</p>
  </section>
</main>

<footer>
  <div class="container">Â© 2024 Aiaxcart Premium. All rights reserved.</div>
</footer>

<!-- Checkout Modal (keep your existing modal) -->
<div id="coOverlay" class="overlay" style="position:fixed;inset:0;background:rgba(0,0,0,.45);display:none;align-items:center;justify-content:center;z-index:9999">
  <div class="modal" style="background:#fff;border-radius:12px;max-width:480px;width:92%;padding:1.2rem">
    <h3 id="coTitle">Checkout</h3>
    <form id="coForm" onsubmit="return false;">
      <input type="hidden" name="product_id"/>
      <input type="hidden" name="product_name"/>
      <div class="row"><label>Buyer Name</label><input required name="buyer_name"></div>
      <div class="row"><label>Email</label><input required type="email" name="buyer_email"></div>
      <div class="row"><label>Account Type</label>
        <select name="account_type" required id="co_accType">
          <option>Solo Profile</option>
          <option>Shared Profile</option>
          <option>Solo Account</option>
          <option>Shared Account</option>
          <option>invite</option>
          <option>famhead</option>
        </select>
      </div>
      <div class="row" id="inviteGmailRow" style="display:none">
        <label>Gmail for Invite</label>
        <input type="email" name="invite_gmail" placeholder="yourgmail@gmail.com">
        <small class="note">Required when Account Type is "invite".</small>
      </div>
      <div class="row"><label>Duration</label>
        <select name="duration_key" required>
          <option>7d</option><option>14d</option><option>1m</option><option>2m</option>
          <option>3m</option><option>4m</option><option>6m</option><option>8m</option>
          <option>10m</option><option>12m</option>
        </select>
      </div>
      <div class="row"><label>Price (â‚±)</label><input type="number" step="0.01" required name="price"></div>
      <div style="display:flex;gap:.6rem;margin-top:.9rem">
        <button type="button" class="btn" onclick="closeCheckout()">Cancel</button>
        <button id="coSubmit" type="submit" class="btn btn-primary">Place Order</button>
      </div>
    </form>
    <div id="coMsg" class="note" style="margin-top:.5rem"></div>
  </div>
</div>

<!-- Auth Modal (keep your existing modal) -->
<div id="authOverlay" class="overlay" style="position:fixed;inset:0;background:rgba(0,0,0,.45);display:none;align-items:center;justify-content:center;z-index:9999">
  <div class="modal" style="background:#fff;border-radius:12px;max-width:480px;width:92%;padding:1.2rem">
    <div style="display:flex;gap:.4rem;margin-bottom:.6rem">
      <button id="tabLogin" class="btn">Login</button>
      <button id="tabSignup" class="btn btn-primary">Sign up</button>
      <button style="margin-left:auto" class="btn" onclick="closeAuth()">Ã—</button>
    </div>
    <div id="formLogin">
      <div class="row"><label>Email</label><input id="liEmail" type="email"></div>
      <div class="row"><label>Password</label><input id="liPass" type="password"></div>
      <button class="btn btn-primary" id="btnLoginGo">Login</button>
    </div>
    <div id="formSignup" style="display:none">
      <div class="row"><label>Full name</label><input id="suName"></div>
      <div class="row"><label>Email</label><input id="suEmail" type="email"></div>
      <div class="row"><label>Password</label><input id="suPass" type="password"></div>
      <div class="row"><label>Confirm</label><input id="suPass2" type="password"></div>
      <button class="btn btn-primary" id="btnSignupGo">Create account</button>
    </div>
    <div id="authMsg" class="note" style="margin-top:.5rem"></div>
  </div>
</div>

<!-- CONFIG -->
<script>
window.CONFIG_PUBLIC = {
  DATABASE:{
    SUPABASE_URL:"https://oujvsjnbxmgpdoftzpxl.supabase.co",
    SUPABASE_ANON_KEY:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im91anZzam5ieG1ncGRvZnR6cHhsIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjI4NzE1NTYsImV4cCI6MjA3ODQ0NzU1Nn0.vs06C-2kx4H2whyTReUPsVgLYhWotfkzetxdKD5LVQo"
  },
  ADMIN:{ OWNER_UID:"2ece6eb8-ed7d-4e52-b1b8-f9220fb87e36" }
};
</script>
<script src="https://unpkg.com/@supabase/supabase-js@2"></script>
<script src="assets/js/aiaxcart/supabase.js?v=6"></script>

<script>
const SB = createDbClient();
const $ = (id)=>document.getElementById(id);

// Category labels mapping
const CATEGORY_LABELS = {
  entertainment: 'ðŸŽ¬ Entertainment',
  streaming: 'ðŸŽ§ Streaming & Music',
  educational: 'ðŸ“š Educational',
  editing: 'ðŸŽ¨ Editing & Creative',
  ai: 'ðŸ¤– AI Tools'
};

// Category descriptions
const CATEGORY_DESCRIPTIONS = {
  entertainment: 'Premium entertainment platforms for movies, shows, and gaming',
  streaming: 'Music and video streaming services with premium features',
  educational: 'Educational platforms and learning resources',
  editing: 'Creative tools for video, photo, and content editing',
  ai: 'Artificial intelligence tools and platforms'
};

/* ===== toast ===== */
function toast(msg, type='ok'){
  const box=$('toast');
  const el=document.createElement('div');
  el.className=`toast ${type}`;
  el.textContent=msg;
  box.appendChild(el);
  setTimeout(()=>{ el.style.opacity='0'; setTimeout(()=>el.remove(),300); },1800);
}

/* ===== auth local ===== */
let currentUser = getSavedUser();
function getSavedUser(){
  const s=localStorage.getItem('aiaxcart_current_user');
  return s?JSON.parse(s):null;
}
function saveUser(u){
  currentUser=u;
  if(u) localStorage.setItem('aiaxcart_current_user',JSON.stringify(u));
  else localStorage.removeItem('aiaxcart_current_user');
}
function openAuth(){ $('authOverlay').style.display='flex'; }
function closeAuth(){ $('authOverlay').style.display='none'; $('authMsg').textContent=''; }

function refreshAuthUI(){
  const ab=$('auth-buttons');
  const ui=$('user-info');
  if(currentUser){
    ab.style.display='none';
    ui.style.display='flex';
    $('user-name').textContent=currentUser.name;
    $('user-avatar').textContent=currentUser.name.charAt(0).toUpperCase();
  }else{
    ab.style.display='block';
    ui.style.display='none';
  }
}
$('login-btn').onclick=openAuth;
$('logout-btn').onclick=()=>{ saveUser(null); refreshAuthUI(); toast('Logged out','ok'); };

/* Category Tabs */
document.querySelectorAll('.category-tab').forEach(tab => {
  tab.addEventListener('click', function() {
    document.querySelectorAll('.category-tab').forEach(t => t.classList.remove('active'));
    this.classList.add('active');
    
    const category = this.dataset.category;
    filterProductsByCategory(category);
  });
});

function filterProductsByCategory(category) {
  const allProducts = document.querySelectorAll('.p-card');
  const categorySections = document.querySelectorAll('.category-section');
  
  if (category === 'all') {
    // Show all categories
    categorySections.forEach(section => {
      section.style.display = 'block';
    });
    allProducts.forEach(product => {
      product.style.display = 'block';
    });
  } else {
    // Hide all categories first
    categorySections.forEach(section => {
      section.style.display = 'none';
    });
    
    // Show only the selected category
    const targetSection = document.querySelector(`.category-section[data-category="${category}"]`);
    if (targetSection) {
      targetSection.style.display = 'block';
    }
  }
}

/* Updated Products Render Function */
async function renderProducts(){
  const container = $('#categories-container');
  container.textContent = 'Loadingâ€¦';

  if(window.AIAX_CATALOG){
    try{ await db_seedCatalogIfEmpty(window.AIAX_CATALOG); }catch(_){}
  }
  
  try{
    const rows = await db_listCatalogWithCounts();
    if(!rows.length){ 
      container.innerHTML='<div class="note">No products available yet.</div>'; 
      return; 
    }

    // Group products by category
    const productsByCategory = {};
    rows.forEach(product => {
      const category = product.category || 'uncategorized';
      if (!productsByCategory[category]) {
        productsByCategory[category] = [];
      }
      productsByCategory[category].push(product);
    });

    let html = '';
    
    // Create section for each category
    Object.entries(productsByCategory).forEach(([category, products]) => {
      const categoryLabel = CATEGORY_LABELS[category] || category;
      const categoryDescription = CATEGORY_DESCRIPTIONS[category] || 'Premium accounts and services';
      
      // Take only first 3 products for display
      const displayProducts = products.slice(0, 3);
      const hasMoreProducts = products.length > 3;
      
      html += `
        <div class="category-section" data-category="${category}">
          <div class="section-header">
            <div>
              <h2 class="section-title">${categoryLabel}</h2>
              <p class="note">${categoryDescription}</p>
            </div>
            ${hasMoreProducts ? `
              <a href="#" class="view-all" data-category="${category}">
                View All (${products.length}) <i class="fas fa-chevron-right"></i>
              </a>
            ` : ''}
          </div>
          <div class="products-grid">
            ${displayProducts.map(product => renderProductCard(product)).join('')}
          </div>
        </div>
      `;
    });

    container.innerHTML = html || '<div class="note">No products available.</div>';
    
    // Add event listeners to View All buttons
    document.querySelectorAll('.view-all').forEach(button => {
      button.addEventListener('click', function(e) {
        e.preventDefault();
        const category = this.dataset.category;
        showAllProducts(category);
      });
    });
    
  } catch(e) {
    console.error('Error loading products:', e);
    container.innerHTML='<div class="note">Failed to load products. Please try again later.</div>';
  }
}

function renderProductCard(product) {
  const hasStock = (product.available || 0) > 0;
  const pricesByType = {};
  
  (product.prices || []).forEach(price => {
    if (!pricesByType[price.account_type]) {
      pricesByType[price.account_type] = [];
    }
    pricesByType[price.account_type].push({
      duration: price.duration_key,
      price: price.price_php
    });
  });
  
  // Get the lowest price for display
  const allPrices = Object.values(pricesByType).flat();
  const lowestPrice = allPrices.length > 0 
    ? Math.min(...allPrices.map(p => p.price))
    : 0;

  const pricesHtml = Object.entries(pricesByType).map(([type, prices]) => {
    const priceList = prices.map(p => `${p.duration}: â‚±${p.price}`).join(' Â· ');
    return `<div class="note"><b>${type}</b> â€” ${priceList}</div>`;
  }).join('');

  return `
    <div class="p-card" data-name="${(product.name || '').toLowerCase()}" data-category="${product.category}">
      <h3>${product.icon || 'ðŸ›’'} ${product.name}</h3>
      <div class="price">Starting at â‚±${lowestPrice}</div>
      <div class="description">Premium access with multiple account options</div>
      <div class="stock-badge ${hasStock ? 'in-stock' : 'out-of-stock'}">
        ${hasStock ? `${product.available} available` : 'Out of stock'}
      </div>
      ${pricesHtml}
      <button class="btn btn-primary" ${hasStock ? '' : 'disabled'}
        onclick="openCheckout('${product.id}','${product.name.replace(/'/g, "\\'")}')">
        <i class="fas fa-shopping-cart"></i> 
        ${hasStock ? 'Buy Now' : 'Unavailable'}
      </button>
    </div>
  `;
}

function showAllProducts(category) {
  // This would typically navigate to a category page or show a modal
  // For now, let's just show an alert and filter to show all products of that category
  filterProductsByCategory(category);
  toast(`Showing all ${CATEGORY_LABELS[category] || category} products`, 'ok');
}

/* Search functionality */
$('product-search').addEventListener('input', (e) => {
  const query = e.target.value.toLowerCase().trim();
  const allProducts = document.querySelectorAll('.p-card');
  const categorySections = document.querySelectorAll('.category-section');
  
  let hasVisibleProducts = false;
  
  categorySections.forEach(section => {
    let sectionHasVisible = false;
    const sectionProducts = section.querySelectorAll('.p-card');
    
    sectionProducts.forEach(product => {
      const productName = product.dataset.name;
      if (productName.includes(query)) {
        product.style.display = 'block';
        sectionHasVisible = true;
        hasVisibleProducts = true;
      } else {
        product.style.display = 'none';
      }
    });
    
    // Show/hide category section based on visible products
    section.style.display = sectionHasVisible ? 'block' : 'none';
  });
  
  // If no products found, show message
  if (!hasVisibleProducts && query) {
    $('#categories-container').innerHTML = `
      <div class="card" style="text-align: center;">
        <h3>No products found</h3>
        <p class="note">No products match your search for "${query}"</p>
        <button class="btn btn-primary" onclick="$('product-search').value=''; renderProducts();">
          Show All Products
        </button>
      </div>
    `;
  } else if (!query) {
    // If search is cleared, restore original view
    categorySections.forEach(section => {
      section.style.display = 'block';
    });
    allProducts.forEach(product => {
      product.style.display = 'block';
    });
  }
});

// Keep your existing functions (openCheckout, closeCheckout, etc.)
function openCheckout(product_id, product_name){
  const f=$('coForm');
  f.product_id.value=product_id;
  f.product_name.value=product_name;
  $('coTitle').textContent='Checkout â€¢ '+product_name;
  if(currentUser){
    f.buyer_name.value=currentUser.name;
    f.buyer_email.value=currentUser.email;
  }
  $('inviteGmailRow').style.display =
    $('co_accType').value.toLowerCase()==='invite' ? 'block' : 'none';
  $('coOverlay').style.display='flex';
}

function closeCheckout(){ $('coOverlay').style.display='none'; }

$('co_accType').onchange=(e)=>{
  $('inviteGmailRow').style.display =
    e.target.value.toLowerCase()==='invite' ? 'block' : 'none';
};

$('coForm').addEventListener('submit',async(e)=>{
  e.preventDefault();
  const f=e.target;
  const btn=$('coSubmit');
  btn.disabled=true;
  try{
    if(f.account_type.value.toLowerCase()==='invite'){
      const gm=(f.invite_gmail.value||'').trim();
      if(!/^[^@]+@gmail\.com$/i.test(gm)) throw new Error('Invite requires a valid Gmail.');
    }
    const order=await db_createOrder({
      buyer_name:f.buyer_name.value.trim(),
      buyer_email:f.buyer_email.value.trim(),
      product_id:f.product_id.value,
      product_name:f.product_name.value,
      account_type:f.account_type.value,
      duration_key:f.duration_key.value,
      price:parseFloat(f.price.value||0),
      invite_gmail:f.invite_gmail?f.invite_gmail.value.trim():null
    });
    $('coMsg').textContent='âœ… Order placed! ID: '+order.id;
    toast('Order placed successfully!','ok');
    setTimeout(()=>{ $('coMsg').textContent=''; closeCheckout(); },2000);
    renderProducts();
    if(currentUser) updateAccountTab();
  }catch(err){
    alert('Checkout failed: '+err.message);
  }finally{
    btn.disabled=false;
  }
});

// Initialize
document.addEventListener('DOMContentLoaded', async ()=>{
  refreshAuthUI();
  await renderProducts();
});

// Keep your other existing functions (tabs, auth flows, etc.) from your original index.html
// They should work with the updated product rendering
</script>
</body>
</html>